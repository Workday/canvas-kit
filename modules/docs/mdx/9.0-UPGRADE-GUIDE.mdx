import {Meta} from '@storybook/addon-docs';

<Meta title="Guides/Upgrade Guides/v9.0" />

# Canvas Kit 9.0 Upgrade Guide

This guide contains an overview of the changes in Canvas Kit v9. Please
[reach out](https://github.com/Workday/canvas-kit/issues/new?labels=bug&template=bug.md) if you have
any questions.

- [Glossary](#glossary)
- [Codemod](#codemod)
- [Token Updates](#token-updates)
  - [Depth](#depth)
- [Component Removals](#component-removals)
  - [Drawer](#drawer)
  - [Layout and Column](#layout-and-column)
  - [Stack, HStack, and VStack](#stack-hstack-and-vstack)
- [Component Updates](#component-updates)
  - [Button](#button)
  - [Toast](#toast)
- [Utility Updates](#utility-updates)
  - [focusRing](#focusring)

## Glossary

### Main

Our Main package of Canvas Kit tokens, components, and utilities at `@workday/canvas-kit-react` have
undergone a full design and a11y review and are approved for use in product.

Breaking changes to code in Main will only occur during major version updates.

---

### Preview

Our Preview package of Canvas Kit tokens, components, and utilities at
`@workday/canvas-kit-preview-react` have undergone a full design and a11y review and are approved
for use in product, but may not be up to the high code standards upheld in the Main package. Think
of Preview as a staging ground for code in beta.

Breaking changes can be deployed to Preview at any time without triggering a major version update,
though such changes will be communicated in advance and accompanied by migration strategies.

---

### Labs

Our Labs package of Canvas Kit tokens, components, and utilities at `@workday/canvas-kit-labs-react`
have **not** undergone a full design and a11y review. Think of Labs as an incubator space for new
and experimental code in alpha.

Breaking changes can be deployed to Labs at any time without triggering a major version update and
may not be subject to the same rigor in communcation and migration strategies reserved for changes
in Preview and Main.

## Codemod

Please use our [codemod package](https://github.com/Workday/canvas-kit/tree/master/modules/codemod)
to automatically update your code to work with most of the breaking changes in v9.

```sh
> npx @workday/canvas-kit-codemod v9 [path]
```

Alternatively, if you're unable to run the codemod successfully using `npx`, you can install the
codemod package as a dev dependency, run it with `yarn`, and then remove the package after you're
finished.

```sh
> yarn add @workday/canvas-kit-codemod --dev
> yarn canvas-kit-codemod v9 [path]
> yarn remove @workday/canvas-kit-codemod
```

> The codemod only works on `.js`, `.jsx`, `.ts`, and `.tsx` files. You'll need to manually edit
> other file types (`.json`, `.mdx`, `.md`, etc.). You may need to run your linter after executing
> the codemod, as its resulting formatting (spacing, quotes, etc.) may not match your project
> conventions.

The codemod will handle _most_ but _not all_ of the breaking changes in v9. **Breaking changes
handled by the codemod are marked with ðŸ¤– in the Upgrade Guide.**

**Please verify all changes made by the codemod.** As a safety precaution, we recommend committing
the changes from the codemod as a single isolated commit (separate from other changes) so you can
roll back more easily if necessary.

## Token Updates

### Depth

In v7, we released an update to our depth tokens that was too bold and harsh for web applications.
We've modified the depth token styles to be more subtle and improve visual design. This change
affects all components which use depth tokens including `Card`, `Toast`, `Dialog`, `Popup`, `Modal`,
and `Menu`. We have not changed which depth values each component references (i.e., `Card` remains
at `depth[1]`).

## Component Removals

### Drawer

<!---
TODO: Please review this section with documenting SidePanel deprication
-->

We've removed the `Drawer` component from Canvas Kit (for reference, see the
[`Drawer`](https://d2krrudi3mmzzw.cloudfront.net/v8/?path=/docs/labs-drawer--basic) from v8). Please
use the [`SidePanel`](/components/containers/side-panel/) in Preview instead.

> **Note:** The `SidePanel` in Main will eventually be replaced with the `SidePanel` in Preview. We
> recommend you use the `SidePanel` in Preview until then.

---

### Layout and Column

We've removed the `Layout` and `Column` components from Canvas Kit (for reference, see
[`Column and Layout`](https://d2krrudi3mmzzw.cloudfront.net/v8/?path=/docs/components-containers-column-and-layout--12-column-layout)
from v8). Please use [`Grid`](/components/layout/grid/) instead. While `Grid` is not a 1:1
replacement for `Layout` and `Column`, it can be used to generate the same types of layouts and
offers a more robust and flexible layout solution.

Please refer to our [Layout examples](/examples/layout) for examples of how to implement common
layouts using `Grid`.

---

### Stack, HStack and VStack

We've removed the `Stack`, `HStack`, and `VStack` components from Canvas Kit (for reference, see
[`Stack`](https://d2krrudi3mmzzw.cloudfront.net/v8/?path=/docs/components-layout-stack--basic-stack)
from v8). We recommend using [`Flex`](/components/layout/flex/) instead. `Flex` supports the same
consistent spacing between its elements via the `gap` prop (analogous to the `spacing` prop from
`Stack`).

```tsx
// v8
<Stack spacing="s">
  ...
</Stack>

// v9
<Flex gap="s">
  ...
</Flex>
```

The orientation of `VStack` elements can be replicated with `Flex` using `flexDirection`.

```tsx
// v8
<VStack>
  ...
</VStack>

// v9
<Flex flexDirection="column">
  ...
</Flex>
```

The `StackProps`, `HStackProps`, `VStackProps`, and `StackStyleProps` types have been removed as
well. All references to these types in your custom components will need to be replaced with
`FlexProps`.

ðŸ¤– The codemod will handle all of the changes above for you automatically.

> **Note:** If you were consuming `StackProps` previously for a custom component, be sure to change
> all references to the old `spacing` prop from `StackProps` to the `gap` prop from `FlexProps`.

## Component Updates

### Button

We've changed the default `type` attribute for all buttons to `type="button"`. Previously, the
`type` attribute was not being set which resulted in the buttons
[defaulting to `type="submit"`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#attributes).

This affects all buttons which extend `BaseButton`:

- `PrimaryButton`
- `SecondaryButton`
- `TertiaryButton`
- `DeleteButton`
- `ToolbarDropdownButton` and `ToolbarIconButton`
- `Pill` and `Pill.IconButton`
- `SegmentedControl.Button` (Main)
- `SegmentedControl.Item` (Preview)
- `Pagination.PageButton`

Any buttons which extend any of the above are affected as well.

This resolves an [issue](https://github.com/Workday/canvas-kit/issues/1938) where clicking certain
buttons within a `form` element would unexpectedly submit the form. Additionally, the default action
of many form controls such as `input` and `textarea` is to click the first submit button; this led
to issues if the first submit button in the form was not intended to be a submit button (an easy
mistake to make when buttons default to `type="submit"`).

This is a breaking change if you expected a button to submit by default, though we do not anticipate
this to be the case for most developers. If you _do_ intend for a button to act as a submit button
within a form, add `type="submit"` to the button.

---

### Toast

We've promoted `Toast` from Labs to Main. It replaces the `Toast` that was previously in Main (for
reference, see
[`Toast`](https://d2krrudi3mmzzw.cloudfront.net/v8/?path=/docs/components-popups-toast--error) in
Main from v8).

`Toast` is a [compound component](/getting-started/for-developers/resources/compound-components/)
which provides a flexible API and access to its internals via its subcomponents. It supports a new
`mode` prop which applies the proper accessibility features to the component based on the desired
mode: `status`, `alert`, or `dialog`.

```tsx
// v8
<Toast actionText="View more details" onActionClick={handleActionClick} onClose={handleClose}>
  Your workbook was successfully processed.
</Toast>

// v9
<Toast mode="dialog">
  <Toast.Icon icon={checkIcon} color={colors.greenApple400} />
  <Toast.Body>
    <Toast.Message>Your workbook was successfully processed.</Toast.Message>
    <Toast.Link onClick={handleActionClick}>View more details</Toast.Link>
  </Toast.Body>
	<Toast.CloseIcon aria-label="Close" onClick={handleClose} />
</Toast>
```

ðŸ¤– The codemod will rewrite your usages of the previous `Toast` in Main to use the compound
component API of the new `Toast` in Main. `mode` will be set to `dialog` if the `Toast` previously
used `actionText` or `onActionClick`. The codemod will also update imports from the Labs `Toast` to
instead import from Main.

> **Note:** You will manually need to set `mode` to `alert` if your `Toast` conveys urgent and
> important information such as an error.

## Utility Updates

### focusRing

We've removed memoization from `focusRing`. The `memoize` argument passed to `focusRing` is no
longer valid and we've removed the exported `memoizedFocusRing`. We were unable to find any examples
of `memoize` or `memoizedFocusRing` being used by our consumers.
