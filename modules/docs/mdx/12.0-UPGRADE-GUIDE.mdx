import {Meta} from '@storybook/addon-docs';
import {Table} from '@workday/canvas-kit-react/table';
import {base, brand, system} from '@workday/canvas-tokens-web';
import {StatusIndicator} from '@workday/canvas-kit-preview-react/status-indicator';
import {cssVar} from '@workday/canvas-kit-styling';
import {Box} from '@workday/canvas-kit-react/layout';

<Meta title="Guides/Upgrade Guides/v12.0" />

# Canvas Kit 12.0 Upgrade Guide

This guide contains an overview of the changes in Canvas Kit v12. Please
[reach out](https://github.com/Workday/canvas-kit/issues/new?labels=bug&template=bug.md) if you have
any questions.

## Why You Should Upgrade

Canvas Kit v12 is transitioning into a
[new way of styling](https://github.com/Workday/canvas-kit/discussions/2265). Theming and building
an in sync Canvas Kit CSS has been at the top of our minds. We've started using our new
[Canvas Tokens Web](https://workday.github.io/canvas-tokens/?path=/docs/docs-getting-started--docs)
package to take advantage of
[CSS variables](https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties) and
provide semantic tokens that can translate to theming components.

A note to the reader:

- While we still support our old tokens from `@workday/canvas-kit-react/tokens` in v12, you must
  install our new tokens from `@workday/canvas-tokens-web`. You can find more info in our
  [docs](https://workday.github.io/canvas-tokens/?path=/docs/docs-getting-started--docs).
- In this release, we've introduced a
  [new styling API](https://workday.github.io/canvas-kit/?path=/docs/styling-basics--create-stencil).
  This shouldn't effect the way you currently style your components. Because we're moving away from
  Emotion, support for style props will eventually be removed, however, this API provide backwards
  compatability. If you want to slowly move off of Emotion as well, you can start styling components
  via the `cs` prop or our new styling utilities.

## Table of contents

- [Canvas Tokens](#canvas-tokens)
- [Codemod](#codemod)
- [Styling Updates](#styling-updates)
  - [Compatability Mode](#compatability-mode)
- [Deprecations](#deprecations)
  - [Form Field Container](#form-field-container)
- [Removals](#removals)
  - [InputIconContainer](#inputiconcontainer)
- [Component Updates](#component-updates)
  - [Styling API and CSS Tokens](#styling-api-and-css-tokens)
  - [Avatar](#avatar)
  - [Form Field](#form-field)
  - [Search Form](#search-form)
  - [Select](#select)
  - [Text Area](#text-area)
- [Troubleshooting](#troubleshooting)
- [Glossary](#glossary)
  - [Main](#main)
  - [Preview](#preview)
  - [Labs](#labs)

## Canvas Tokens

In v12, all the components listed in this guide have started using our new
[Canvas Tokens Web](https://workday.github.io/canvas-tokens/?path=/docs/docs-getting-started--docs).

In v12 you must add `@workday/canvas-tokens-web` to ensure our components are properly styled and
the variables are defined. For more information on installing and using, please reference our tokens
[docs](https://workday.github.io/canvas-tokens/?path=/docs/docs-getting-started--docs).

## Codemod

In v12, we have done some infrastructure updates with moving to Webpack 5 and Storybook 7. With
these updates has come some formatting issues after running our codemods. We recommend running a
formatter to address the format issues that have been introduced in v12.

## Styling Updates

### Compatability Mode

In v12, we have addressed a style merge issue with removing forced compatibility mode. For more
information on this change, please read our
[discussion](https://github.com/Workday/canvas-kit/discussions/2893).

## Deprecations

We add the [@deprecated](https://jsdoc.app/tags-deprecated.html) JSDoc tag to code we plan to remove
in a future major release. This signals consumers to migrate to a more stable alternative before the
deprecated code is removed.

### Form Field Container

**PR:** [#2865](https://github.com/Workday/canvas-kit/pull/2865)

We've deprecated `FormField.Container`. Please use `FormField.Field` or `FormFieldGroup.Field` for
grouped inputs, this ensures proper label alignment and spacing of inputs and hint text, regardless
of the orientation.

```tsx
// v11
<FormField>
  <FormField.Label>Email</FormField.Label>
  <FormField.Container>
    <FormField.Input as={TextInput} />
    <FormField.Hint>You must provide an email</FormField.Hint>
  </FormField.Container>
</FormField>

// v12
<FormField>
  <FormField.Label>Email</FormField.Label>
  <FormField.Field>
    <FormField.Input as={TextInput} />
    <FormField.Hint>You must provide an email</FormField.Hint>
  </FormField.Field>
</FormField>
```

## Removals

Removals are deletions from our codebase and you can no longer consume this component. We've either
promoted or replaced a component or utility.

### InputIconContainer

**PR:** [#2838](https://github.com/Workday/canvas-kit/pull/2838)

We've removed `InputIconContainer` from Main. Please use
[InputGroup](https://workday.github.io/canvas-kit/?path=/docs/components-inputs-text-input--icons)
from Main instead.

---

## Component Updates

### Styling API and CSS Tokens

**PRs:** [#2825](https://github.com/Workday/canvas-kit/pull/2825),
[#2795](https://github.com/Workday/canvas-kit/pull/2795),
[#2793](https://github.com/Workday/canvas-kit/pull/2793),
[#2881](https://github.com/Workday/canvas-kit/pull/2881)

Several components have been refactored to use our new
[Canvas Tokens](https://workday.github.io/canvas-tokens/?path=/docs/docs-getting-started--docs) and
[styling API](https://workday.github.io/canvas-kit/?path=/docs/styling-basics--create-modifiers#createstyles-api).
The React interface **has not changed**, but CSS variables are now used for dynamic properties.

The following components are affected:

- `Avatar`
- `Dialog`
- `Modal`
- `Popup`
- `TextArea`
- `TextInput`
- `Toast`

> **Note:** These components also support our new `cs` prop for styling. Learn more about styling
> with `cs` in our
> [documentation](https://workday.github.io/canvas-kit/?path=/docs/styling-basics--cs-prop).

### Avatar

**PR** [#2793](https://github.com/Workday/canvas-kit/pull/2793)

Avatar has been updated to use our new
[styling utilities](https://workday.github.io/canvas-kit/?path=/docs/styling-basics--create-stencil).
The following changes have been made to the API:

- `Avatar.Size` has been deprecated. The `size` prop still accepts `Avatar.Size` in addition to the
  following values:
  `"extraExtraLarge" | "extraLarge" | "large" | "medium" | "small" | "extraSmall" | (string{})`
- `Avatar.Variant` has been deprecated. The `variant` prop still accepts `Avatar.Variant` in
  addition to the following values: `"dark" | "light"`
- The `as` prop now accepts any element, not just `div`.

> **Note:** Both `Avatar.Size` and `Avatar.Variant` have been deprecated in favor of the new string
> union types. You will see a console warn message while in development if you're still using this.
> Please update your types and usage before v13.

### Form Field

**PRs:** [#2865](https://github.com/Workday/canvas-kit/pull/2865),
[#2881](https://github.com/Workday/canvas-kit/pull/2881)

We've promoted FormField from [Preview](#preview) to [Main](#main). The following changes has been
made to provide more flexibility and better explicit components when using inputs.

- The orientation prop on the `FormField` component will be updated to accept the following values:
  `vertical`, `horizontalStart`, and `horizontalEnd`. `horizontal` will still be accepted as a value
  in v12, but it will be deprecated and slated for removal in a future major release. These changes
  are intended to provide more flexibility with label alignments on `FormField` elements.

> **Note**: The horizontal alignment of start and end are relative to its container, meaning start
> and end match the flex property of `flex-start` and `flex-end`. This is especially applicable for
> moving between RTL (right-to-left) and LTR (left-to-right) languages.

> **Note:** Orientation "horizontal" has been deprecated. You will see a console warn message
> suggesting to update your types and usage to `horizontalStart`, `horizontalEnd` or `vertical`.

- `useFormFieldModel`: `orientation` has been added back into `useFormFieldModel`. While we still
  support compat mode due to
  [style merging issues](https://github.com/Workday/canvas-kit/discussions/2893), having orientation
  on the model allows for proper styling of sub components.

- Styles clean up. `FormField.Hint` and `FormField.Label` where using `margin` for spacing. We've
  updated styles so that the containing element uses `gap` for proper spacing.

> **Note:** If spacing seems off between the input and hint text, ensure you're using
> `FormField.Field` wrapping your input and hint text.

##### Breaking API Change

The newly promoted `FormField` is a
[compound component](https://workday.github.io/canvas-kit/?path=/docs/guides-compound-components--page).
Due to the different APIs of the component, this change is **not codemodable**. The following shows
an example of how to **update** your code to match the new compound component API.

```tsx
// v11 FormField in Main
<FormField
  error={FormField.ErrorType.Alert}
  labelPosition={FormField.LabelPosition.Left}
  useFieldSet={true}
  required={true}
  hintId="hint-alert"
  hintText="Please enter a valid email."
  label="Email"
>
  <TextInput onChange={handleChange} value={value} />
</FormField>


// v12 Newly promoted FormField from Preview to Main
<FormField
  error="error"
  orientation="horizontalStart"
  isRequired={true}
>
	<FormField.Label>Email</FormField.Label>
	<FormField.Field>
		<FormField.Input as={TextInput} onChange={handleChange} value={value} />
		<FormField.Hint>Please enter a valid email.</FormField.Hint>
	</FormField.Field>
</FormField>
```

**Noticeable changes:**

- `error` prop takes in the following values: `"error" | "alert"`.
- `labelPosition` becomes `orientation` with the following values:
  `"horizontal" | "horizontalStart" | "horizontalEnd" | "vertical"`.
- `useFieldSet` is no longer valid. If you want to group inputs, use
  [`FormFieldGroup`](#form-field-group) component.
- `required` becomes `isRequired`.
- `hintId` is no longer needed. The component handles associating the hint text, label and input
  automatically. If you wish to have a unique `id`, you can add one onto the `FormField` element.
- `hintText` is no longer a valid prop. Use `FormField.Hint` sub component.
- `errorLabel` and `alertLabel` are no longer valid props. Customizing your hint text inside of
  `FormField.Hint`.
- `label` is no longer a valid prop. Use `FormField.Label` sub component to render your label text.
- Instead of rendering an input, ensure you use `FormField.Input` with the `as` prop. This ensures
  proper error handling and aria attributes for accessibility.

ðŸ¤– The codemod will handle the change of `orientation="horizontal"` to
`orientation="horizontalStart"` if you're using the string literal values. It will also handle
updating your imports from `@workday/canvas-kit-preview-react/form-field` to
`@workday/canvas-kit-react/form-field`.

#### Form Field Group

We've added a new component under `FromField` to allow users to group inputs without worrying about
setting the `as` prop on the `FormField` component.

Use `FormFieldGroup` when you have a group of inputs that need to be associated to one another, like
`RadioGroup` or a group of `Checkbox`'s.

`FormFieldGroup` supports the same props of `FormField`:

- `error`: `"alert" | "error"` Defines the error around the whole group of inputs.
- `orientation`: `"horizontalStart" | "horizontalEnd" | "vertical" | "horizontal" `. Defines the
  label placement.
- `isRequired`: `true` Defines if a group like `RadioGroup` is required.

#### FormField Field

We've added a new sub-component to `FormField` and `FormFieldGroup`, `FormField.Field` and
`FormFieldGroup.Field`. This sub-component is meant to ensure that the label is always aligned with
the input regardless of the `orientation`prop's value on`FormField` or `FormFieldGroup`. This
component should replace `FormField.Container` and always be used to ensure proper alignment of the
label and hint text. Our examples have been updated to reflect this.

Although there is no codemod for this change and it's non-breaking, we suggest moving towards adding
this sub-component when using `FormField`. This component also exists on `FormFieldGroup`.

```tsx
<FormField orientation="horizontal">
  <FormField.Label>Email</FormField.Label>
  <FormField.Field>
    <FormField.Input as={TextInput} />
    <FormField.Hint>You must provide an email</FormField.Hint>
  </FormField.Field>
</FormField>
```

### Search Form (Labs)

**PRs:** [#2934](https://github.com/Workday/canvas-kit/pull/2934),

`SearchForm` is now using the newly promoted `FormField` component. `SearchForm` now uses `labelId`
to set the appropiate aria attributes and `id` on the underlying input element. There should be no
visual breaking changes and the API remains the same.

### Select

**PR:** [#2865](https://github.com/Workday/canvas-kit/pull/2865)

As we transition to use our CSS tokens to provide better theming capabilities and our new styling
methods, we're moving away from components extending `Themeable`. `Themeable` has been removed from
`SelectProps.`

If you wish to theme `Select` we suggest using the CanvasProvider to do so.

```tsx
const theme: PartialEmotionCanvasTheme = {
  canvas: {
    palette: {
      common: {
        focusOutline: 'pink',
      },
      primary: {
        main: 'green',
        light: 'lightgreen',
      },
    },
  },
};

//...

<CanvasProvider theme={theme}>
  <Flex cs={parentContainerStyles}>
    <Select items={options}>
      <FormField>
        <FormField.Label>Contact</FormField.Label>
        <FormField.Input as={Select.Input} onChange={handleChange} />
        <Select.Popper>
          <Select.Card>
            <Select.List>
              {item => {
                return <Select.Item>{item}</Select.Item>;
              }}
            </Select.List>
          </Select.Card>
        </Select.Popper>
      </FormField>
    </Select>
    Selected Value: {value}
  </Flex>
</CanvasProvider>;
```

### Text Area

**PR:** [#2825](https://github.com/Workday/canvas-kit/pull/2825)

`TextAreaResizeDirection` is no longer a TypeScript enum, but a JavaScript object. This change does
not effect runtime at all, but may cause TypeScript errors if you use `TextAreaResizeDirection` as a
type.

```tsx
// v11
interface MyProps {
  resize?: TextAreaResizeDirection;
}

// 12
type ValueOf<T> = T[keyof T];
interface MyProps {
  resize?: ValueOf<typeof TextAreaResizeDirection>;
}
```

## Troubleshooting

### My Styles Seem Broken?

Our components are reliant on our new Canvas Tokens Web package. Be sure you install
`@workday/canvas-tokens-web`. For more information, reference our
[Getting Started docs](https://workday.github.io/canvas-tokens/?path=/docs/docs-getting-started--docs)
for this package.

### Did You Upgrade All Canvas Kit Related Packages?

In order for all the packages to work in harmony, you must upgrade all Canvas Kit packages to the
same version that you're using, including:

- `@workday/canvas-kit-react`
- `@workday/canvas-kit-preview-react`
- `@workday/canvas-kit-labs-react`
- `@workday/canvas-kit-styling`
- `@workday/canvas-kit-react-fonts`
- `@workday/canvas-kit-docs`

## Glossary

### Main

Our Main package of Canvas Kit tokens, components, and utilities at `@workday/canvas-kit-react` has
undergone a full design and a11y review and is approved for use in product.

Breaking changes to code in Main will only occur during major version updates and will always be
communicated in advance and accompanied by migration strategies.

---

### Preview

Our Preview package of Canvas Kit tokens, components, and utilities at
`@workday/canvas-kit-preview-react` has undergone a full design and a11y review and is approved for
use in product, but may not be up to the high code standards upheld in the [Main](#main) package.
Preview is analagous to code in beta.

Breaking changes are unlikely, but possible, and can be deployed to Preview at any time without
triggering a major version update, though such changes will be communicated in advance and
accompanied by migration strategies.

Generally speaking, our goal is to eventually promote code from Preview to [Main](#main).
Occasionally, a component with the same name will exist in both [Main](#main) and Preview (for
example, see Segmented Control in [Preview](/components/buttons/segmented-control/) and
[Main](https://d2krrudi3mmzzw.cloudfront.net/v8/?path=/docs/components-buttons-segmented-control--basic)).
In these cases, Preview serves as a staging ground for an improved version of the component with a
different API. The component in [Main](#main) will eventually be replaced with the one in Preview.

---

### Labs

Our Labs package of Canvas Kit tokens, components, and utilities at `@workday/canvas-kit-labs-react`
has **not** undergone a full design and a11y review. Labs serves as an incubator space for new and
experimental code and is analagous to code in alpha.

Breaking changes can be deployed to Labs at any time without triggering a major version update and
may not be subject to the same rigor in communcation and migration strategies reserved for breaking
changes in [Preview](#preview) and [Main](#main).
`import { opacity } from "@workday/canvas-tokens-web/dist/es6/system"`
