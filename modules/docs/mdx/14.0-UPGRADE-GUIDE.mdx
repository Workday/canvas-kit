import {Meta} from '@storybook/addon-docs';

<Meta title="Guides/Upgrade Guides/v14.0/Overview" />

# Canvas Kit 14.0 Upgrade Guide

This guide contains an overview of the changes in Canvas Kit v14. Please
[reach out](https://github.com/Workday/canvas-kit/issues/new?labels=bug&template=bug.md) if you have
any questions.

## Why You Should Upgrade

v14.0 Introduces Workday's new brand direction which includes a new color palette and with it, some styling updates to our components.

> **Note:** v14.0 requires an upgrade to the `@workday/canvas-tokens-web` package to `@v3.0.0`.

## Table of contents

- [Codemod](#codemod)
  - [Instructions](#instructions)
- [Theming](#theming)
- [Component Updates](#component-updates)
  - [Avatar Preview](#avatar-preview)
  - [Branding Changes](#branding-changes)
  - [Buttons](#buttons)
  - [Card](#card-)
  - [Count Badge](#count-badge)
  - [Expandable](#expandable)
  - [Hyperlink and ExternalHyperlink](#hyperlink-and-external-hyperlink)
  - [Loading Dots](#loading-dots)
  - [Pill](#pill)
  - [SearchForm](#search-form)
  - [Status Indicator (Preview)](#status-indicator-preview)
- [Deprecations](#deprecations)
  - [Avatar in Main](#avatar-in-main)
  - [Combobox (Labs)](#combobox-labs)
  - [Radio (Main)](#radio-main)
  - [Segmented Control (Main)](#segmented-control-main)
  - [Side Panel (Main)](#side-panel-main)
  - [Tokens](#tokens)
- [Removals](#removals)
  - [Deprecated Buttons](#deprecated-buttons)
  - [Menu (preview)](#menu-preview)
  - [readyOnlyPillStencil and removeablePillStencil](#readyOnlyPillStencil-and-removeablePillStencil)
- [Troubleshooting](#troubleshooting)
- [Glossary](#glossary)
  - [Main](#main)
  - [Preview](#preview)
  - [Labs](#labs)

## Codemod

We've provided a [codemod](https://github.com/Workday/canvas-kit/tree/master/modules/codemod) to
automatically update your code to work with most of the breaking changes in v14. **Breaking changes
handled by the codemod are marked with ðŸ¤– in the Upgrade Guide.**

A codemod is a script that makes programmatic transformations on your codebase by traversing the
[AST](https://www.codeshiftcommunity.com/docs/understanding-asts), identifying patterns, and making
prescribed changes. This greatly decreases opportunities for error and reduces the number of manual
updates, which allows you to focus on changes that need your attention. **We highly recommend you
use the codemod for these reasons.**

If you're new to running codemods or if it's been a minute since you've used one, there are a few
things you'll want to keep in mind.

- Our codemods are meant to be run sequentially. For example, if you're using v8 of Canvas Kit,
  you'll need to run the v9 codemod before you run v10 and so on.
- The codemod will update your code to be compatible with the specified version, but it will **not**
  remove outdated dependencies or upgrade dependencies to the latest version. You'll need to upgrade
  dependencies on your own.
  - We recommend upgrading dependencies before running the codemod.
  - Always review your `package.json` files to make sure your dependency versions look correct.
- The codemod will not handle every breaking change in v14. You will likely need to make some manual
  changes to be compatible. Use our Upgrade Guide as a checklist.
- Codemods are not bulletproof.
  - Conduct a thorough PR and QA review of all changes to ensure no regressions were introduced.
  - As a safety precaution, we recommend committing the changes from the codemod as a single
    isolated commit (separate from other changes) so you can roll back more easily if necessary.

We're here to help! Automatic changes to your codebase can feel scary. You can always reach out to
our team. We'd be very happy to walk you through the process to set you up for success.

### Instructions

The easiest way to run our codemod is to use `npx` in your terminal.

```sh
npx @workday/canvas-kit-codemod v14 [path]
```

Be sure to provide specific directories that need to be updated via the `[path]` argument. This
decreases the amount of AST the codemod needs to traverse and reduces the chances of the script
having an error. For example, if your source code lives in `src/`, use `src/` as your `[path]`. Or,
if you have a monorepo with three packages using Canvas Kit, provide those specific packages as your
`[path]`.

Alternatively, if you're unable to run the codemod successfully using `npx`, you can install the
codemod package as a dev dependency, run it with `yarn`, and then remove the package after you're
finished.

```sh
yarn add @workday/canvas-kit-codemod --dev
yarn canvas-kit-codemod v14 [path]
yarn remove @workday/canvas-kit-codemod
```

> **Note**: The codemod only works on `.js`, `.jsx`, `.ts`, and `.tsx` files. You'll need to
> manually edit other file types (`.json`, `.mdx`, `.md`, etc.). You may need to run your linter
> after executing the codemod, as its resulting formatting (spacing, quotes, etc.) may not match
> your project conventions.

## Theming

**PR:** [#3394](https://github.com/Workday/canvas-kit/pull/3394)

- `CanvasThemePalette` has been updated to include a `lighter` color.
- `CanvasTheme` has been updated to include a `lighter` color.

## Component Updates

### Avatar (Preview)

**PR:** [#3430](https://github.com/Workday/canvas-kit/pull/3430)

A new `Avatar` component has been added to the `@workday/canvas-kit-preview-react` package that
matches our brand refresh.

#### API Changes from the Main Avatar

- `Avatar` has a `name` prop. This is required to ensure a fallback if a `url` is not provided. The
  `name` prop also determines the initials and the `alt` text for the image if a `url` is provided.
- `url` stays the same. This prop is optional and will be used to display an image `Avatar`.
- `variant` defines the color of the `Avatar`. The default is `blue` but you can choose one of the
  following colors:
  - `teal`
  - `purple`
  - `amber`
  - `blue`
- By default, the `Avatar` will render a `div` element. If you need to render a `button` element use
  the `BaseAvatar` component.
- `size` accepts the following values:
  - `extraExtraLarge`
  - `extraLarge`
  - `large`
  - `medium`
  - `small`
  - `extraSmall`
  - `extraExtraSmall`

### Branding Changes ðŸ’…

Several components have been refactored to reflect our new brand direction. Most of these changes
revolve around the use of our new brand colors. For a better guide on what has changed in our v3.0.0 tokens, please view the Tokens v3.0.0 [Upgrade Guide](https://workday.github.io/canvas-tokens/?path=/docs/guides-upgrade-guides-v3-overview--docs).

> **Note:** If you want a visual diff of the changes, please view the [Visual Changes](https://workday.github.io/canvas-kit/?path=/docs/guides-upgrade-guides-v14-visual-changes--docs) guide.

The following components have been updated:

- `Breadcrumbs` [#3270](https://github.com/Workday/canvas-kit/pull/3270), [#3447](https://github.com/Workday/canvas-kit/pull/3447)
- `Buttons` [#3394](https://github.com/Workday/canvas-kit/pull/3394)
- `ColorPicker` (Main) [#3307](https://github.com/Workday/canvas-kit/pull/3307)
- `ColorPicker` (preview) [#3307](https://github.com/Workday/canvas-kit/pull/3307)
- `InformationHighlight` [#3443](https://github.com/Workday/canvas-kit/pull/3443)
- `LoadingDots` (Main) [#3393](https://github.com/Workday/canvas-kit/pull/3393)
- `Pagination` (Preview) [#3300](https://github.com/Workday/canvas-kit/pull/3300)
- `Pill` [#3446](https://github.com/Workday/canvas-kit/pull/3446)
- `SearchForm` (Labs) [#3303](https://github.com/Workday/canvas-kit/pull/3303)
- `SegmentedControl` (Main) [#3278](https://github.com/Workday/canvas-kit/pull/3278)
- `SegmentedControl` (Preview) [#3278](https://github.com/Workday/canvas-kit/pull/3278)
- `ToolbarDropdownButton` [#3293](https://github.com/Workday/canvas-kit/pull/3293)
- `ToolbarIconButton` [#3293](https://github.com/Workday/canvas-kit/pull/3293)

### Buttons

#### TertiaryButton

The `TertiaryButton` component no longer supports the `isThemable` prop. To customize the appearance
of `TertiaryButton`, use the `cs` prop for custom styles or the `colors` prop for palette-based
color overrides.

**After in v14**

```tsx
<TertiaryButton cs={{[buttonStencil.vars.background: 'red']}}>
  Click Me
</TertiaryButton>
```

The shape of `TertiaryButton` has changed to have rounded corners, aligning with other buttons and
our new brand direction.

If you need to override default styles, follow
[this guide](https://workday.github.io/canvas-kit/?path=/docs/components-buttons--docs#custom-styles)

### Card ðŸš¨

**PR:** [#3350](https://github.com/Workday/canvas-kit/pull/3350)

We've rebranded the `Card` component to align with our new brand directions and provide better
visual hierarchy and more flexible styling options. The following changes have been made:

#### Default Card No Longer Has Shadow

The default `Card` variant no longer includes a box shadow, creating a cleaner, flatter appearance that
aligns with our new brand's emphasis on simplicity and clarity. This is a **visual breaking change**
that may affect your application's visual hierarchy. If your design requires a shadow you can add it
through `cs` prop.

**Before in v13**

```tsx
<Card>
  <Card.Heading>Card Title</Card.Heading>
  <Card.Body>Card content with shadow</Card.Body>
</Card>
```

**After in v14**
Only do this if you need a shadow. Otherwise, adhere to the default styling.

```tsx
import {system} from '@workday/canvas-tokens-web'

<Card cs={{boxShadow: system.depth[1]}}>
  <Card.Heading>Card Title</Card.Heading>
  <Card.Body>Card content with shadow</Card.Body>
</Card>
```

#### New Card Variants

We've added two new variants to provide more styling flexibility:

- **`borderless`**: Use this variant when placing cards on colored backgrounds where you want the
  card to blend seamlessly without borders or shadows.
- **`filled`**: Use this variant when you need a card with a grayish background to create visual
  separation from the page background.

The `variant` prop is optional - if no variant is specified, the card will use the default styling.

```tsx
// Default card (no variant prop needed) with a border and no box shadow
<Card>
  <Card.Heading>Default Card</Card.Heading>
  <Card.Body>Default styling with borders, no shadow</Card.Body>
</Card>

// Borderless variant for colored backgrounds
<Card variant="borderless">
  <Card.Heading>Card on Colored Background</Card.Heading>
  <Card.Body>Content blends with background</Card.Body>
</Card>

// Filled variant with grayish background
<Card variant="filled">
  <Card.Heading>Card with grayish Background</Card.Heading>
  <Card.Body>Content with visual separation</Card.Body>
</Card>
```

#### Gap Instead of Margins

We've replaced the individual margins on `Card.Heading` and `Card.Body` with `gap`. The card now uses `display: flex` with `flex-direction: column` by default, and the
`gap` prop provides consistent spacing between all direct children. This provides more consistent
spacing and better control over the layout. This is a **visual breaking change** that may affect the
spacing between card elements.

**Before in v13**

```tsx
<Card>
  <Card.Heading marginBlock="zero">Title</Card.Heading>
  <Card.Body marginBlock="zero">Card without any spacing</Card.Body>
</Card>
```

**After in v14**

```tsx
<Card cs={{gap: system.space.zero}}>
  <Card.Heading>Title</Card.Heading>
  <Card.Body>Card without any spacing</Card.Body>
</Card>
```

### Count Badge

**PR:** [#3411](https://github.com/Workday/canvas-kit/pull/3411)

The `CountBadge` component has been updated to reflect our new brand direction.

Additionally, a new `emphasis` prop has been added, allowing you to choose between `high` and `low`
emphasis for the badge.

**Count Badge variants in v14**

```tsx
<CountBadge /> // Default count badge with high emphasis
<CountBadge variant="inverse" /> // Inverse default count badge to use on dark backgrounds
// new
<CountBadge emphasis="low" /> // Default count badge with low emphasis
<CountBadge variant="inverse" emphasis="low" /> // Inverse count badge with low emphasis
```

### Expandable

**PRs:** [#3389](https://github.com/Workday/canvas-kit/pull/3389),
[#3430](https://github.com/Workday/canvas-kit/pull/3430)

- `<Expandable.Target>` hover state has been update to use `system.color.bg.alt.soft` instead of
  `system.color.bg.alt.default` to match our new brand directions.
- The `focus` state has been update to use `system.color.border.primary.default` to ensure the same
  focus state color across all components.
- `Expandable.Avatar` has been updated to use the `Avatar` component from Preview. This change
  requires that you update the `altText` prop to `name`.

> ðŸ¤– The codemod will handle the change of `altText` to `name` on `Expandable.Avatar`.

### Hyperlink and External Hyperlink

**PR:** [#3390](https://github.com/Workday/canvas-kit/pull/3390)

- `Hyperlink` and `ExternalHyperlink` now have a `standalone` and `standalone-inverse` variant. This
  removes the underline text decoration for use outside the context of body text.

**In v14**

```tsx
<Hyperlink variant="standalone" href="#hyperlink">Hyperlink</Hyperlink>
<ExternalHyperlink variant="standalone" href="#external-hyperlink">External Hyperlink</ExternalHyperlink>
<Hyperlink variant="standalone-inverse" href="#hyperlink">Hyperlink</Hyperlink>
<ExternalHyperlink variant="standalone-inverse" href="#external-hyperlink">External Hyperlink</ExternalHyperlink>
```

> **Note:** Only use the `standalone` or `standalone-inverse` variant in cases where the
> `<HyperLink>` and `<ExternalHyperlink>` are used outside the context of body text.

### Loading Dots

**PR:** [#3393](https://github.com/Workday/canvas-kit/pull/3393)

- We've updated the colors to match our brand refresh. The default color changes from
  `system.color.bg.alt.strong` to `system.color.bg.muted.strong`.
- `LoadingDots` now has a `inverse` variant. Use this variant when the Loading Dots are on a dark
  background or image.

**After in v14**

```tsx
// Use inverse variant when the Loading Dots are on a dark background or image
<LoadingDots variant="inverse" />
```

### Pill (Preview)

**PRs:** [#3430](https://github.com/Workday/canvas-kit/pull/3430), [#3446](https://github.com/Workday/canvas-kit/pull/3446)

- `Pill` has been updated to use the `Avatar` component from Preview. This change requires that you
  provide a value for the `name` prop.

> ðŸ¤– The codemod will handle the change of `altText` to `name` on `Pill.Avatar`.

- The `Pill` component no longer supports `'default'` as a value for the `variant` prop. If the
  `variant` prop is not provided, the component will use its default styling.

- `readyOnlyPillStencil` and `removeablePillStencil` have been removed due to some styling clean up. Please use `pillStencil` instead.

**Before in v13**

```tsx
<Pill variant="default">
  <Pill.Avatar altText="John Doe" />
  <Pill.Label>John Doe</Pill.Label>
</Pill>
```

**After in v14**

```tsx
<Pill>
  <Pill.Avatar name="John Doe" />
  <Pill.Label>John Doe</Pill.Label>
</Pill>
```


### Search Form ðŸš¨

**PR:** [#3303](https://github.com/Workday/canvas-kit/pull/3303)

- `SearchThemeAttributes` type has been updated. Both `boxShadow` and `boxShadowFocus` now only
  accept a `string` instead of `string | string[]`.

**Before in v13**

```tsx
const customTheme = {
	background: colors.cinnamon600,
	backgroundFocus: colors.frenchVanilla100,
	placeholderColor: colors.frenchVanilla100,
	placeholderColorFocus: colors.blackPepper400,
	boxShadow: ['10px 5px 5px red', '60px -16px teal']
	boxShadowFocus: ['10px 5px 5px red', '60px -16px teal']
} as SearchThemeAttributes;
	//...

	<SearchForm
	searchTheme={customTheme}
	autocompleteItems={menuItems}
	onInputChange={filterMenuItems}
	onSubmit={handleSubmit}
/>
```

**After in v14**

```tsx
const customTheme = {
  background: colors.cinnamon600,
  backgroundFocus: colors.frenchVanilla100,
  placeholderColor: colors.frenchVanilla100,
  placeholderColorFocus: colors.blackPepper400,
  boxShadow: '10px 5px 5px red',
  boxShadowFocus: '10px 5px 5px red',
} as SearchThemeAttributes;
//...

<SearchForm
  searchTheme={customTheme}
  autocompleteItems={menuItems}
  onInputChange={filterMenuItems}
  onSubmit={handleSubmit}
/>;
```

- `SearchTheme` enum type has been updated to have string values `light`, `dark` and `transparent`.
  This **should not** affect the way you use the type unless you're passing a `number` of `0`, `1`
  or `2` to the `searchTheme` prop.

### Status Indicator (Preview) ðŸš¨

**PR:** [#3287](https://github.com/Workday/canvas-kit/pull/3287)

Preview `StatusIndicator` is a rounder and more vibrant base emphasis (`low`).

Variant names of the preview `StatusIndicator` have been updated by the following mapping:

- `blue` -> `primary`
- `green` -> `success`
- `orange` -> `caution`
- `red` -> `critical`
- `gray` -> `neutral`

The `StatusIndicatorVariant` type has been updated to contain the new variant names listed above. If
you use the old variant values, update to use the new ones mapped above. It has also been
deprecated. Use `StatusIndicatorProps['variant']` instead.

## Deprecations

We add the [@deprecated](https://jsdoc.app/tags-deprecated.html) JSDoc tag to code we plan to remove
in a future major release. This signals consumers to migrate to a more stable alternative before the
deprecated code is removed.

### Avatar in Main

**PR:** [#3430](https://github.com/Workday/canvas-kit/pull/3430)

We've deprecated the `Avatar` component in `@workday/canvas-kit-react` Main package. Please use the
`Avatar` component in our Preview package.

**Before in v13**

```tsx
import { Avatar } from '@workday/canvas-kit-react/avatar';

// For Avatars that where divs
<Avatar altText="John Doe" size="extraExtraLarge" as="div" url={yourImageUrl} />

// For Avatars that where buttons
<Avatar altText="John Doe" onClick={() => console.log('Avatar clicked')} />
```

**After in v14**

```tsx
import {Avatar} from '@workday/canvas-kit-preview-react/avatar';
// name is used as a fallback if the image url is broken or still loading
// variant light or dark are not used. Instead, variant defines the color of the Avatar
<Avatar name="John Doe" size="extraExtraLarge" variant="teal" url={yourImageUrl} />;
```

If you need to render a `button` element use the `BaseAvatar` component.

```tsx
import {BaseAvatar} from '@workday/canvas-kit-preview-react/avatar';

<BaseAvatar
  name="John Doe"
  size="extraExtraLarge"
  variant="teal"
  as="button"
  onClick={() => console.log('Avatar clicked')}
>
  <BaseAvatar.Name name="John Doe" />
</BaseAvatar>;
```

### Combobox (Labs)

The Combobox component in `@workday/canvas-kit-labs-react/combobox` has been deprecated and will be
removed in a future major release. Please migrate to the
[Combobox](https://workday.github.io/canvas-kit/?path=/docs/components-inputs-combobox--docs) in
`@workday/canvas-kit-react`.

### Radio (Main)

The Radio component in `@workday/canvas-kit-react/radio` has been deprecated. Please use the new
[Radio](https://workday.github.io/canvas-kit/?path=/docs/components-inputs-radio--docs) component
from the same package, which offers improved accessibility and API consistency.

### Segmented Control (Main)

The Segmented Control component in `@workday/canvas-kit-react/segmented-control` has been
deprecated. Please migrate to the new
[Segmented Control](https://workday.github.io/canvas-kit/?path=/docs/components-inputs-segmented-control--docs)
for improved features and support.

### Side Panel (Main)

The Side Panel component in `@workday/canvas-kit-react/side-panel` is now deprecated and will be
removed in a future release. Please use the new
[Side Panel](https://workday.github.io/canvas-kit/?path=/docs/components-navigation-side-panel--docs)
for enhanced functionality.

### Tokens

The legacy tokens from `@workday/canvas-kit-react/tokens` are now deprecated. Please use the new
[Canvas Tokens Web](https://workday.github.io/canvas-tokens/?path=/docs/docs-getting-started--docs)
package (`@workday/canvas-tokens-web`) for all token usage. Follow
[a migration guide](https://workday.github.io/canvas-kit?path=/docs/guides-tokens-migration-overview--docs)
for smootier upgrade.

## Removals

Removals are deletions from our codebase and you can no longer consume this component. We've either
promoted or replaced a component or utility.

### Deprecated Buttons

**PR:** [#3429](https://github.com/Workday/canvas-kit/pull/3439)

Long overdue, but a sign of moving forward, we are removing our `DeprecatedButton`. Our design
system supported this for quite some time, but with the advancement in theming, our components API
and our flexibility, it is time for us to finally remove this component. This component has served
as a reminder of how far we've come and it part we're thankful for this change.

Al though unlikely, but not impossible, if you were using `DeprecatedButton` please use our flexible
and themable buttons like `PrimaryButton`, `ScondaryButton` or `TertiaryButton`.

### Menu (preview)

**PR:** [#3353](https://github.com/Workday/canvas-kit/pull/3353)

We've removed `Menu` from `@workday/canvas-kit-preview-react` package. Please use
[Menu](https://workday.github.io/canvas-kit/?path=/docs/components-popups-menu--docs) from
`@workday/canvas-kit-react` instead.

### readyOnlyPillStencil and removeablePillStencil

The `readyOnlyPillStencil` and `removeablePillStencil` utilities have been removed from the Pill
package. Please use `pillStencil` instead.

---

## Troubleshooting

- When upgrading to the latest major version of Canvas Kit, all related Canvas Kit packages should
  be updated at the same time:
  - `"@workday/canvas-kit-react": "^13.5.6"` -> `"@workday/canvas-kit-react": "^14.0.0"`
  - `"@workday/canvas-kit-styling": "^13.5.6"` -> `"@workday/canvas-kit-styling": "^14.0.0"`
  - `"@workday/canvas-kit-preview-react": "^13.5.6"` ->
    `"@workday/canvas-kit-preview-react": "^14.0.0"`
  - `"@workday/canvas-kit-labs-react": "^13.5.6"` -> `"@workday/canvas-kit-labs-react": "^14.0.0"`
- Our components rely on the `@workday/canvas-tokens-web` package which provides our CSS variables
  and ensures the correct styling of our components. Make sure to upgrade to the latest version of
  Canvas Tokens Web and install it correctly. For more information,
  [view our docs](https://workday.github.io/canvas-tokens/?path=/docs/docs-getting-started--docs).

## Glossary

For an overview of the different packages we provide, plase view our docs
[here](https://workday.github.io/canvas-kit/?path=/docs/guides-packages--docs).
