import {Meta} from '@storybook/addon-docs';

<Meta title="Welcome/Upgrade Guides/v8.0" />

# Canvas Kit 8.0 Upgrade Guide

This guide contains an overview of the changes in Canvas Kit v8. Please
[reach out](https://github.com/Workday/canvas-kit/issues/new?labels=bug&template=bug.md) if you have
any questions.

- [Codemod](#codemod)
- [General Updates](#general-updates)
  - [IE11 No Longer Supported](#ie11-no-longer-supported)
  - [Removal of Default Exports](#removal-of-default-exports)
  - [Responsive Styles](#responsive-styles)
  - [Refactor Style Props](#refactor-style-props)
  - [Testing](#testing)
- [New Components](#new-components)
  - [Grid](#grid)
  - [Text](#text)
  - [Segmented Control (Preview)](#segmented-control-preview)
  - [Status Indicator (Preview)](#status-indicator-preview)
- [Component Deprecations](#component-deprecations)
  - [Drawer](#drawer)
  - [Menu (Preview)](#menu-preview)
  - [Layout and Column](#layout-and-column)
- [Component Updates](#component-updates)
  - [Box](#box)
  - [Breadcrumbs](#breadcrumbs)
  - [Menu (Main)](#menu-main)
  - [Modal](#modal)

## Codemod

Please use our [codemod package](https://github.com/Workday/canvas-kit/tree/master/modules/codemod)
to automatically update your code to work with many of the breaking changes in v8.

```sh
> npx @workday/canvas-kit-codemod v8 [path]
```

Alternatively, if you're unable to run the codemod successfully using `npx`, you can install the
codemod package as a dev dependency, run it with `yarn`, and then remove the package after you're
finished.

```sh
> yarn add @workday/canvas-kit-codemod --dev
> yarn canvas-kit-codemod v8 [path]
> yarn remove @workday/canvas-kit-codemod
```

> The codemod only works on `.js`, `.jsx`, `.ts`, and `.tsx` files. You'll need to manually edit
> other types of files (`.json`, `.mdx`, `.md`, etc.). You may need to run your linter after
> executing the codemod, as its resulting formatting (spacing, quotes, etc.) may not match your
> project conventions.

The codemod will handle _many_ but _not all_ of the breaking changes in v8. **Breaking changes
handled by the codemod are marked with 🤖 in the Upgrade Guide.**

**Please verify all changes made by the codemod.** As a safety precaution, we recommend committing
the changes from the codemod as a single isolated commit (separate from other changes) so you can
roll back more easily if necessary.

## General Updates

### IE11 No Longer Supported

Starting with v8, Canvas Kit will no longer support IE11.

We've removed all IE11-specific code including polyfills. Applications built using Canvas Kit v8 and
above may no longer run in IE11 and may fail to bootstrap with an error and/or a white screen.

**Do not upgrade to v8 if your application needs to support IE11.**

---

### Removal of Default Exports

We've removed all remaining default exports from our packages to maintain consistency with our newer
(and recently updated) components and systems which favor named exports. The following components
have been updated to provide named exports instead of default exports (in cases where the component
provided both default and named exports, the default export has been removed).

#### Main (canvas-kit-react)

- AccentIcon
- AppletIcon
- Avatar
- Breadcrumbs (formerly in Preview)
- Canvas
- Checkbox
- CountBadge
- FormField
- Graphic
- Icon
- LoadingDots
- Radio
- SegmentedControl
- Select
- SidePanel
- StatusIndicator
- Switch
- Svg
- SystemIcon
- SystemIconCircle
- Table
- TextArea
- TextInput
- Toast
- Tooltip

#### Labs (canvas-kit-labs-react)

- Combobox
- Drawer

#### Preview (canvas-kit-preview-react)

- ColorPicker
- Menu
- Select
- SidePanel

#### Fonts (canvas-kit-react-fonts)

- fonts

🤖 The codemod will rewrite your default imports to named imports.

---

### Responsive Styles

> Coming Soon (https://github.com/Workday/canvas-kit/pull/1779)

---

### Refactor Style Props

> Coming Soon (https://github.com/Workday/canvas-kit/pull/1783)

---

### Testing

> Coming Soon (https://github.com/Workday/canvas-kit/pull/1800)

## New Components

### Grid

We've introduced a new `Grid` component to the Main package. `Grid` is a low-level layout component
that provides a common, ergonomic API for building two-dimensional layouts (rows and columns) with
[CSS Grid](https://developer.mozilla.org/en-US/docs/Learn/CSS/CSS_layout/Grids).

For more information, view the `Grid` component [docs](/components/layout/grid/).

---

### Text

We've introduced a group of Text components to the Main package: `Text`, `LabelText`, `Title`,
`Heading`, `BodyText`, and `Subtext`. Together they provide a common, ergonomic API for rendering
text with built-in support for our Canvas Kit type tokens.

For more information, view the Text component [docs](/components/text/).

---

### Segmented Control (Preview)

> Coming Soon (https://github.com/Workday/canvas-kit/pull/1819)

---

### Status Indicator (Preview)

> Coming Soon (https://github.com/Workday/canvas-kit/issues/1637)

## Component Deprecations

### Deprecation Types

#### Soft Deprecation

A soft-deprecated component is still available with its full functionality, but it will have been
renamed with a prefix to indicate its soft-deprecated status. It will also include a console warning
announcing its deprecation. This warning will only be triggered on the component's initial render.

Soft-deprecated types and utilities will also have been renamed but generally will not trigger a
console warning.

#### Hard Deprecation

A hard-deprecated component or package is no longer available. You will need to follow the method
prescribed in our Upgrade Guide to update your application. Please
[reach out](https://github.com/Workday/canvas-kit/issues/new?labels=bug&template=bug.md) to our team
directly if you need additional help.

---

### Drawer

We've [soft-deprecated](#soft-deprecation) `Drawer` and renamed the following items:

- `Drawer` to `DeprecatedDrawer`
- `DrawerProps` to `DeprecatedDrawerProps`
- `DrawerHeader` to `DeprecatedDrawerHeader`
- `DrawerHeaderProps` to `DeprecatedDrawerHeaderProps`

```tsx
// v7
import {Drawer, DrawerHeader} from '@workday/canvas-kit-labs-react/drawer';

<Drawer
  header={
    <DrawerHeader
      closeIconAriaLabel="Close"
      onClose={() => console.log('onClose callback')}
      title="Deprecated Drawer Header"
    />
  }
/>;

// v8
import {DeprecatedDrawer, DeprecatedDrawerHeader} from '@workday/canvas-kit-labs-react/drawer';

<DeprecatedDrawer
  header={
    <DeprecatedDrawerHeader
      closeIconAriaLabel="Close"
      onClose={() => console.log('onClose callback')}
      title="Deprecated Drawer Header"
    />
  }
/>;
```

🤖 The codemod will rename `Drawer`, `DrawerProps`, `DrawerHeader` and `DrawerHeaderProps` to their
deprecated names.

You may continue to use this component, but please note that we plan to
[hard-deprecate](#hard-deprecation) it in v9. Consider using the
[Side Panel](/components/containers/side-panel/) in the Preview package instead.

---

### Menu (Preview)

We've [soft-deprecated](#soft-deprecation) the `Menu` in Preview and renamed the following items:

- `Menu` to `DeprecatedMenu`
- `MenuProps` to `DeprecatedMenuProps`
- `MenuState` to `DeprecatedMenuState`
- `MenuItem` to `DeprecatedMenuItem`
- `MenuItemProps` to `DeprecatedMenuItemProps`

```tsx
// v7
import {Menu, MenuItem, MenuProps, MenuItemProps} from '@workday/canvas-kit-preview-react/menu';

interface AnotherMenuProps extends MenuProps {
  specialProp?: boolean;
}
type CustomMenuItemProps = MenuItemProps;

const CustomMenu = () => {
  return (
    <Menu>
      <MenuItem>First Item</MenuItem>
    </Menu>
  );
};

// v8
import {
  DeprecatedMenu,
  DeprecatedMenuItem,
  DeprecatedMenuProps,
  DeprecatedMenuItemProps,
} from '@workday/canvas-kit-preview-react/menu';

interface AnotherMenuProps extends DeprecatedMenuProps {
  specialProp?: boolean;
}

type CustomMenuItemProps = DeprecatedMenuItemProps;

const CustomMenu = () => {
  return (
    <DeprecatedMenu>
      <DeprecatedMenuItem>First Item</DeprecatedMenuItem>
    </DeprecatedMenu>
  );
};
```

🤖 The codemod will rename `Menu`, `MenuProps`, `MenuState`, `MenuItem` and `MenuItemProps` to their
deprecated names.

You may continue to use this component, but please note that we plan to
[hard-deprecate](#hard-deprecation) it in v9. Consider using the [Menu](/components/popups/menu/) in
the Main package instead.

---

### Layout and Column

We've [soft-deprecated](#soft-deprecation) `Layout` and `Column` and renamed the following items:

- `Layout` to `DeprecatedLayout`
- `LayoutProps` to `DeprecatedLayoutProps`
- `Column` to `DeprecatedColumn`
- `ColumnProps` to `DeprecatedColumnProps`

```tsx
// v7
import {Layout, Column} from '@workday/canvas-kit-react/layout';

<Layout gutter={0}>
  <Layout.Column spacing={0}>
    <Card />
  </Layout.Column>
</Layout>;

// v8
import {DeprecatedLayout, DeprecatedColumn} from '@workday/canvas-kit-react/layout';

<DeprecatedLayout gutter={0}>
  <DeprecatedLayout.Column spacing={0}>
    <Card />
  </DeprecatedLayout.Column>
</DeprecatedLayout>;
```

🤖 The codemod will rename `Layout`, `LayoutProps`, `Column` and `ColumnProps` to their deprecated
names.

You may continue to use these components, but please note that we plan to
[hard-deprecate](#hard-deprecation) them in v9. Consider using the newly-released [Grid](#grid)
component instead.

## Component Updates

### Box

`Box` now supports the following props to set font and text styles: `fontFamily`, `fontSize`,
`fontStyle`, `fontWeight`, `lineHeight`, `letterSpacing`, `textAlign`, `textDecoration`,
`textTransform`, `textShadow`, `whiteSpace`, and `wordBreak`.

```tsx
// v7
const StyledBox = styled(Box)({
  fontFamily: 'monospace',
  fontSize: type.properties.fontSizes[16],
  fontWeight: type.properties.fontWeights.medium
})

<StyledBox />

// v8
<Box fontFamily="monospace" fontSize={16} fontWeight="medium" />
```

---

### Breadcrumbs

`Breadcrumbs` has been promoted to the Main package. It now uses the list system from our
[Collection API](/getting-started/for-developers/resources/collection-api/) which provides new
overflow behavior based on container width.

The following code-moddable changes have been made to the `Breadcrumbs` API (see below for
additional changes requiring manual work):

- `Breadcrumbs` has been promoted from Preview (`@workday/canvas-kit-preview-react`) to Main
  (`@workday/canvas-kit-react`).
- `Breadcrumbs.Nav` has been replaced with `Breadcrumbs`. Any `aria-label` previously applied to
  `Breadcrumbs.Nav` should now be applied to `Breadcrumbs`.
- `Breadcrumbs.CollapsibleList` has been renamed to `Breadcrumbs.List`.
- `Breadcrumbs.ListItem` has been renamed to `Breadcrumbs.Item`.

🤖 The codemod will handle all of the changes above for you automatically.

```tsx
// v7
<Breadcrumbs.Nav aria-label="breadcrumb">
  <Breadcrumbs.List>
    <Breadcrumbs.ListItem>
      <Breadcrumbs.Link href="/">Home</Breadcrumbs.Link>
    </Breadcrumbs.ListItem>
    <Breadcrumbs.ListItem>
      <Breadcrumbs.Link href="/menus">Menus</Breadcrumbs.Link>
    </Breadcrumbs.ListItem>
    <Breadcrumbs.CurrentItem>Dinner</Breadcrumbs.CurrentItem>
  </Breadcrumbs.List>
</Breadcrumbs.Nav>

// v8
<Breadcrumbs>
  <Breadcrumbs.List>
    <Breadcrumbs.Item>
      <Breadcrumbs.Link href="/">Home</Breadcrumbs.Link>
    </Breadcrumbs.Item>
    <Breadcrumbs.Item>
      <Breadcrumbs.Link href="/menus">Menus</Breadcrumbs.Link>
    </Breadcrumbs.Item>
    <Breadcrumbs.CurrentItem>Dinner</Breadcrumbs.CurrentItem>
  </Breadcrumbs.List>
</Breadcrumbs>
```

Additionally, there are a handful of changes to the `Breadcrumbs` API which will require manual
updates on your part:

- Changes to Redirects
- Updated Overflow Behavior

We've outlined these changes in more detail below.

#### Changes to Redirects

We've removed `onAction` from `Breadcrumbs.Link`. `Breadcrumbs.Link` now defaults to redirecting
with an `href`, which means the page will hard-redirect when the link is clicked.

If you're in a single-page application (SPA) environment, you may want to use the internal SPA
router instead. You can override the hard-redirect with a custom `onClick` handler that blocks the
default behavior of the event and passes the link path along to your SPA router. Most of our
consumers use `react-router-dom` for managing SPA routing; here are examples of how to use `onClick`
with v5 and v6 of `react-router-dom`.

```ts
// React Router DOM v5 API
import {useHistory} from 'react-router-dom';
import {Breadcrumbs} from '@workday/canvas-kit-react/breadcrumbs';
...
const history = useHistory();
const handleClick = (event: React.MouseEvent<HTMLAnchorElement, MouseEvent>, link?: string) => {
      event.preventDefault();
    // if no link is provided, default to the current path
    history.push(link || window.location.pathname);
}
return (
  <Breadcrumbs.Link href="/account" onClick={handleClick}>
    Account
  </Breadcrumbs.Link>
);

// React Router DOM v6 API
import {useNavigate} from 'react-router-dom';
import {Breadcrumbs} from '@workday/canvas-kit-react/breadcrumbs';
...
const navigate = useNavigate();
const handleClick = (event: React.MouseEvent<HTMLAnchorElement, MouseEvent>, link?: string) => {
      event.preventDefault();
    // if no link is provided, default to the current path
    navigate(link || window.location.pathname);
}
return (
  <Breadcrumbs.Link href="/account" onClick={handleClick}>
    Account
  </Breadcrumbs.Link>
);
```

Read more about [moving from Router DOM v5 to v6](https://reactrouter.com/en/main/upgrading/v5).

#### Updated Overflow Behavior

We've removed the component-specific overflow functionality from `Breadcrumbs` now that it uses the
overflow behavior provided by the Collection API. In order to enable the new overflow behavior,
you'll need to use the dynamic API by passing an array of items to `Breadcrumbs` (rather than
passing the items as statically defined `children` via JSX). The items can be passed to
`Breadcrumbs` via its `items` prop or via an `items` key within a provided `model`.

Here's an example of how to convert a v7 instance of overflow `Breadcrumbs` using the static API to
the v8 equivalent using the dynamic API with the `items` prop.

```ts
// v7
import {Breadcrumbs} from '@workday/canvas-kit-preview-react/breadcrumbs';

export const OldCollapsibleList = () => {
  return (
    <Breadcrumbs.Nav aria-label="breadcrumb">
      <Breadcrumbs.CollapsibleList buttonAriaLabel="more links" maxWidth={300}>
        <Breadcrumbs.ListItem>
          <Breadcrumbs.Link href="/">Home</Breadcrumbs.Link>
        </Breadcrumbs.ListItem>
        <Breadcrumbs.ListItem>
          <Breadcrumbs.Link href="/menus">Menus</Breadcrumbs.Link>
        </Breadcrumbs.ListItem>
        <Breadcrumbs.ListItem>
          <Breadcrumbs.Link href="/lunch">Lunch</Breadcrumbs.Link>
        </Breadcrumbs.ListItem>
        <Breadcrumbs.ListItem>
          <Breadcrumbs.Link href="/small-plates-and-appetizers">
            Small Plates & Appetizers
          </Breadcrumbs.Link>
        </Breadcrumbs.ListItem>
        <Breadcrumbs.CurrentItem>Focaccia Genovese</Breadcrumbs.CurrentItem>
      </Breadcrumbs.CollapsibleList>
    </Breadcrumbs.Nav>
  );
};

// v8
const NewOverflowList = () => {
  const [items] = React.useState([
    {id: '1', text: 'Home', link: '/'},
    {id: '2', text: 'Menus', link: '/menus'},
    {id: '3', text: 'Lunch', link: '/lunch'},
    {id: '4', text: 'Small Plates & Appetizers', link: '/small-plates-and-appetizers'},
    {id: '5', text: 'Focaccia Genovese'},
  ]);

  return (
    <Breadcrumbs items={items}>
      <Breadcrumbs.List>
        {item =>
          item.link ? (
            <Breadcrumbs.Item>
              <Breadcrumbs.Link href={item.link}>{item.text}</Breadcrumbs.Link>
            </Breadcrumbs.Item>
          ) : (
            <Breadcrumbs.CurrentItem>{item.text}</Breadcrumbs.CurrentItem>
          )
        }
      </Breadcrumbs.List>
      <Breadcrumbs.Menu.Popper>
        <Breadcrumbs.Menu.Card>
          <Breadcrumbs.Menu.List>
            {(item: Breadcrumb) => <Breadcrumbs.Menu.Item>{item.text}</Breadcrumbs.Menu.Item>}
          </Breadcrumbs.Menu.List>
        </Breadcrumbs.Menu.Card>
      </Breadcrumbs.Menu.Popper>
    </Breadcrumbs>
  );
};
```

---

### Menu (Main)

We've updated the depth value of `Menu.Card` from `1` to `3`. This is a visually breaking change.

---

### Modal

We've updated the `Modal` component to include new touch and responsive behaviors. The responsive
`Modal` will be displayed when users are browsing on screen sizes between `320px` and `768px` and
will have the following visual differences compared to the standard `Modal`:

- Padding between the edge of `Modal.Card` and its contents reduced to `16px` (standard: `32px`)
- Border radius of `Modal.Card` increased to `24px` (standard: `8px`)
- Vertical space between `Modal.Heading` and `Modal.Body` reduced to `16px` (standard: `24px`)
- `Modal` animates from the `bottom center` and is aligned near the bottom of the viewport

Additionally, users interacting with `Modal` on touch will not be able to exit out of the modal by
tapping on the overlay.
