import {Meta} from '@storybook/addon-docs';

<Meta title="Welcome/Migration Guides/v7.0" />

# Canvas Kit 7.0 Migration Guide

This guide contains breaking changes in Canvas Kit v7. Please
[reach out](https://github.com/Workday/canvas-kit/issues/new?labels=bug&template=bug.md) if you have
any questions.

- [Codemod](#codemod)
- [Tokens](#tokens)
  - [Depth](#depth)
- [Components](#components)
  - [Component Deprecations](#component-deprecations)
  - [Component Promotions](#component-promotions)
  - [Action Bar](#action-bar)
  - [Button](#button)
  - [Icon](#icon)
  - [Popper](#popper)
  - [Popup](#popup)
  - [Segmented Control](#segmented-control)
  - [Side Panel](#side-panel)
  - [Status Indicator](#status-indicator)

## Codemod

Please use our [codemod package](https://github.com/Workday/canvas-kit/tree/master/modules/codemod)
to automatically update your code to work with many of the breaking changes as you migrate from
Canvas Kit v6 to v7:

```sh
> npx @workday/canvas-kit-codemod v7 [path]
```

> Note: This codemod only works on `.js`, `.jsx`, `.ts`, and `.tsx` extensions. You may need to make
> some manual changes in other file types (`.json`, `.mdx`, `.md`, etc.).

> Note: You may need to run your linter after executing the codemod, as its resulting formatting
> (spacing, quotes, etc.) may not match your project's styling.

**Breaking changes handled by this codemod will be marked with a ðŸ¤–.**

**Please verify all changes made by the codemod. As a safety precaution, we recommend committing the
changes from the codemod as a single isolated commit (separate from other changes) so you can
rollback more easily if necessary.**

[Let us know](https://github.com/Workday/canvas-kit/issues/new?labels=bug&template=bug.md) if you
encounter any issues or use cases that we've missed.

## Tokens

### Depth

**Changes:**

- Removed `inset` depth
- Added new depth values: `none` (to remove the default depth from a component), `5` and `6`
- Updated all depth values: depth now adds only `box-shadow` with two shadows and no border

We've also changed the default depth for the following components:

- Breadcrumbs (Dropdown Menu): Depth 2 â†’ Depth 3
- Card: Depth 2 â†’ Depth 1
- Color Picker (Palette): Depth 2 â†’ Depth 5
- Combobox: Depth 1 â†’ Depth 3
- Dialog: Depth 2 â†’ Depth 5
- Menu: Depth 2 â†’ Depth 3
- Modal: Depth 2 â†’ Depth 6
- Popup: Depth 2 â†’ Depth 5
- Side Panel (Preview, alternate variant): Depth 3 â†’ Depth 5
- Toast: Depth 2 â†’ Depth 5

## Components

### Component Deprecations

#### Deprecation Types

There are two types of deprecations: soft and hard.

##### Soft Deprecation

A soft-deprecated component is still available with its full functionality, but it will have been
renamed with a prefix to indicate its soft-deprecated status. It will also include a console warning
announcing its deprecation. This warning will only be triggered on the component's initial render.

Soft-deprecated types and utilities will also be renamed but generally will not trigger a console
warning.

##### Hard Deprecation

A hard-deprecated component or package is no longer available. You will need to follow the method
prescribed in our migration guide to update your application. Please
[reach out](https://github.com/Workday/canvas-kit/issues/new?labels=bug&template=bug.md) to our team
directly if you need additional help.

#### Cookie Banner

We are [hard-deprecating](#hard-deprecation) `CookieBanner`. Please reference this
[example](https://workday.github.io/canvas-kit/?path=/story/examples-cookiebanner-react--basic) if
you would like to migrate away from `CookieBanner`.

#### Page Header

We are [hard-deprecating](#hard-deprecation) `PageHeader`. Please reference this
[example](https://workday.github.io/canvas-kit/?path=/story/examples-pageheader-react--basic) if you
would like to migrate away from `PageHeader`.

#### Header / Global Header

We are [hard-deprecating](#hard-deprecation) `Header`. Please reference this
[example](https://workday.github.io/canvas-kit/?path=/story/examples-globalheader-react--basic) if
you would like to migrate away from `Header`.

---

### Component Promotions

We've [promoted](https://github.com/Workday/canvas-kit/issues/1395) the following components in v7:

- `Box` from `@workday/canvas-kit-labs/common` to `@workday/canvas-kit-react/layout`
- `Flex` from `@workday/canvas-kit-labs/layout` to `@workday/canvas-kit-react/layout`
- `Stack` from `@workday/canvas-kit-labs/layout` to `@workday/canvas-kit-react/layout`

ðŸ¤– The codemod will update imports for the promoted components.

```tsx
// v6
import {Box} from '@workday/canvas-kit-labs-react/common';

// v7
import {Box} from '@workday/canvas-kit-react/layout';
```

Note that the APIs for the promoted components remain unchanged.

---

### Action Bar

`ActionBar` is now a
[compound component](/getting-started/for-developers/resources/compound-components/).

We've removed the `fixed` prop from `ActionBar`. It now uses the `position` prop (defaults to
`fixed`) to set the container position.

ðŸ¤– The codemod will remove uses of the `fixed` prop from `ActionBar`.

---

### Button

#### Removal of Icon Button

To consolidate Button APIs, we've removed `IconButton` in favor of `SecondaryButton` and
`TertiaryButton`. The following table shows how `IconButton` variants in v6 map to their
corresponding `Button` in v7.

| v6 `IconButton` variant    | v7 `Button` (and variant, if necessary)  |
| -------------------------- | ---------------------------------------- |
| `circle` (default variant) | `TertiaryButton`                         |
| `circleFilled`             | `SecondaryButton`                        |
| `inverse`                  | `TertiaryButton` with `inverse` variant  |
| `inverseFilled`            | `SecondaryButton` with `inverse` variant |
| `plain`                    | Unsupported                              |
| `square`                   | Unsupported                              |
| `squareFilled`             | Unsupported                              |

> Note: See below for more information about how to manually migrate from
> [unsupported v6 variants](#unsupported-iconbutton-variants).

ðŸ¤– Use the codemod to migrate your `IconButton` components in v6 to their corresponding `Button` in
v7:

```tsx
// v6
<IconButton icon={plusIcon} />
<IconButton variant="circleFilled" icon={plusIcon} />
<IconButton variant="inverse" icon={plusIcon} />
<IconButton variant="inverseFilled" icon={plusIcon} />

// v7
<TertiaryButton icon={plusIcon} />
<SecondaryButton icon={plusIcon} />
<TertiaryButton variant="inverse" icon={plusIcon} />
<SecondaryButton variant="inverse" icon={plusIcon} />
```

##### Unsupported IconButton Variants

In order to simplify our API, we no longer support the `plain`, `square`, and `squareFilled`
variants from `IconButton`.

`square`, `squareFilled` and `plain` `IconButton` components should be transitioned to the new
icon-only versions of the `Button` components (`PrimaryButton`, `SecondaryButton`, and
`TertiaryButton`), `ToolbarIconButton`, or `SegmentedControl`. You may use `ToolbarIconButton` if
you would still like to have a square icon that is toggleable.

These changes are **not** handled by the codemod.

> If none of these options support your use case, we've introduced a low-level
> [`BaseButton`](#basebutton) component which allows you to modify the colors, props, and size of
> the button. For an example of it being used, reference our
> [`PageButton`](https://github.com/Workday/canvas-kit/blob/master/modules/react/pagination/lib/Pagination/PageButton.tsx)
> component.

##### Removal of IconButtonProps

The `IconButtonProps` interface no longer exists now that `IconButton` has been removed.

This change is **not** handled by the codemod.

##### Toggled

There is no equivalent to the `IconButton` `toggled` prop in `SecondaryButton` and `TertiaryButton`.
If you wish to render a button with a toggled state, consider using `ToolbarIconButton`.

This change is **not** handled by the codemod.

#### Icon Position

The `iconPosition` prop determines where an icon should be rendered relative to the button text.
We've updated the values from `left` and `right` to `start` and `end` respectively to better reflect
bidirectionality. The default value is `start`.

```tsx
// v6
iconPosition: 'left' | 'right';

// v7
iconPosition: 'start' | 'end';
```

ðŸ¤– The codemod will map `left` to `start` and `right` to `end` for all uses of `iconPosition`.

`iconPosition` will have no effect if you're rendering a button with only an icon and no text.

#### Removal of dataLabel

In order to simplify our API, we've removed the `dataLabel` prop from `PrimaryButton` and
`SecondaryButton`.

Given the varied use of `dataLabel`, this change is **not** handled by the codemod. Here's an
example of how to achieve a similar styling in v7:

```tsx
// v6
<PrimaryButton dataLabel="1:00">Time</PrimaryButton>;

// v7
import {space, type} from '@workday/canvas-kit-react/common';

const DataLabel = styled('span')({
  position: 'relative', // Fixes an IE issue with text within button moving on click
  overflow: 'hidden',
  whiteSpace: 'nowrap',
  fontWeight: type.properties.fontWeights.regular,
  marginLeft: space.xxxs,
});

return (
  <PrimaryButton>
    Time
    <DataLabel>1:00</DataLabel>
  </PrimaryButton>
);
```

#### Sizes

Each `Button` now supports the following sizes: `extraSmall`, `small`, `medium` and `large`
(defaults to `medium`).

```tsx
  <PrimaryButton icon={plusIcon} size="extraSmall" />
  <PrimaryButton icon={plusIcon} size="small" />
  <PrimaryButton icon={plusIcon} size="medium" /> // default
  <PrimaryButton icon={plusIcon} size="large" />
```

#### BaseButton

> **Disclaimer**: We **strongly** advise consumers **not** to use `BaseButton` and to instead rely
> on `PrimaryButton`, `SecondaryButton` and `TertiaryButton` whenever possible. `BaseButton` is
> strictly provided as a last resort if no other option is available for your use case.

As part of our Button restructuring, we've created a low level `BaseButton` component. This
component isn't intended to be used outside of Canvas Kit, but we do export it for very specific use
cases. `BaseButton` is a styled `<button>` element which supports style properties such as `colors`,
`padding`, and `width` among many others.

Here's an example:

```tsx
import * as React from 'react';
import {colors} from '@workday/canvas-kit-react/tokens';
import {BaseButton} from '@workday/canvas-kit-react/button';
import {plusIcon} from '@workday/canvas-system-icons-web';

const getBasicButtonColors = () => {
  return {
    default: {
      background: colors.blueberry400,
      label: colors.frenchVanilla100,
      icon: colors.frenchVanilla100,
    },
    hover: {
      background: colors.blueberry500,
      label: colors.frenchVanilla100,
      icon: colors.frenchVanilla100,
    },
    active: {
      background: colors.blueberry500,
      label: colors.frenchVanilla100,
      icon: colors.frenchVanilla100,
    },
    focus: {
      background: colors.blueberry400,
      label: colors.frenchVanilla100,
      icon: colors.frenchVanilla100,
    },
    disabled: {
      background: colors.blueberry400,
    },
  };
};

export type BasicButtonProps = React.ButtonHTMLAttributes<HTMLButtonElement> & {};

export const BasicButton = ({children, ...elemProps}: BasicButtonProps) => {
  return (
    <BaseButton
      colors={getPaginationButtonColors(toggled)}
      {...elemProps}
    >
      <BaseButton.Label>{children}</BaseButton.Label>
      <BaseButton.Icon icon={plusIcon}>
    </StyledToggleButton>
  );
};
```

`BaseButton` uses our `Box` component under the hood, which allows it to accept a variety of style
properties. Because of the flexibility of this component, consumers can use it to create toggled
buttons or other buttons that don't fall under the use cases supported by our standard `Button`
components.

---

### Icon

`AccentIcon`, `AppletIcon`, `Graphic`, `Icon`, `Svg`, `SystemIcon`, and `SystemIconCircle` now
support [ref forwarding](https://reactjs.org/docs/forwarding-refs.html) through use of the
[`createComponent`](https://github.com/Workday/canvas-kit/blob/ff77c5bd83e41c3ab2b9c55e41a8b7c1fde33a1b/modules/react/common/lib/utils/components.ts#L167)
utility from the `common` module.

These components previously supported an `iconRef` prop. In v7, you'll need to use `ref` instead of
`iconRef`:

```tsx
// v6
<SystemIcon iconRef={ref} />;

// v7
<SystemIcon ref={ref} />;
```

ðŸ¤– The codemod will update all Icon components that previously supported `iconRef` to use `ref`
instead.

---

### Popper

We've removed the `containerElement` prop from `Popper` because it's no longer needed with the
Fullscreen API.

---

### Popup

`Popup.Card` components (this includes `Modal.Card` and `Dialog.Card`) are now flexbox containers.
This was done to support overflowing content (by default, the `Popup.Body` component). The card is a
vertical flexbox container and `Popup.Heading`, `Popup.Body`, and any other children are flex items.
`Popup.Body` now has `overflow-y: auto` to naturally allow the body content to overflow in a scroll
container. This is a breaking change if your `Popup`, `Modal`, or `Dialog` doesn't work with a
flexbox with `flex-direction: column`. In most cases, this shouldn't matter. If this change does
cause your popup to display incorrectly, you may need to play around with flex item containers.

Here's an example of where your current implementation might break. A common `Modal` has a heading,
body, and footer (Cancel/Submit buttons). If the Cancel and Submit buttons are direct children of
the `Modal.Card` like the following...

```tsx
<Modal.Card>
  <Modal.Heading>Some Heading</Modal.Heading>
  <Modal.Body>Some Body</Modal.Body>
  <SecondaryButton>Cancel</SecondaryButton>
  <PrimaryButton>Submit</PrimaryButton>
</Modal.Card>
```

...the buttons will become vertical flex items instead of the default which is displaying
inline-block. Before v7, the buttons would layout next to each other horizontally. In v7, the
buttons will stack vertically. To fix this, you'll need to add another element as a flex item in the
`Modal.Card`. The following example uses `HStack` to achieve the desired horizontal layout:

```tsx
<Modal.Card>
  <Modal.Heading>Some Heading</Modal.Heading>
  <Modal.Body>Some Body</Modal.Body>
  <HStack spacing="s">
    <SecondaryButton>Cancel</SecondaryButton>
    <PrimaryButton>Submit</PrimaryButton>
  </HStack>
</Modal.Card>
```

If your code contains any hacks to make a `Modal` overflow, those hacks should now be removed.
[This example shows how body content overflows](https://workday.github.io/canvas-kit/?path=/docs/components-popups-modal-react--body-overflow)
(you may have to limit your browser height to see the overflow). Before v7, you had to manually set
the `max-height` of the `Modal.Body` element using calculations. These should now be removed. The
`Popup.Card` now has a max height and the `Popup.Body` height is automatically calculated.

---

### Segmented Control

`SegmentedControl` is now a
[compound component](/getting-started/for-developers/resources/compound-components/).

Given the [removal of `IconButton`](#removal-of-icon-button) in v7, you'll now need to use
`SegmentedControl.Button` instead.

```tsx
// v6
<SegmentedControl value={value} onChange={handleToggle}>
  <IconButton
    icon={listViewIcon}
    value="list-view"
    aria-label="List View"
    onClick={e => console.log('Existing IconButton onClick callback')}
  />
  <IconButton icon={worksheetsIcon} value="table-view" aria-label="Table View" disabled={true} />
  <IconButton icon={deviceTabletIcon} value="device-view" aria-label="Device View" />
  <IconButton icon={percentageIcon} value="percent-view" aria-label="Percent View" />
</SegmentedControl>

// v7
<SegmentedControl value={value} onChange={handleToggle}>
  <SegmentedControl.Button
    icon={listViewIcon}
    value="list-view"
    aria-label="List View"
    onClick={e => console.log('Existing IconButton onClick callback')}
  />
  <SegmentedControl.Button
    icon={worksheetsIcon}
    value="table-view"
    aria-label="Table View"
    disabled={true}
  />
  <SegmentedControl.Button icon={deviceTabletIcon} value="device-view" aria-label="Device View" />
  <SegmentedControl.Button icon={percentageIcon} value="percent-view" aria-label="Percent View" />
</SegmentedControl>
```

ðŸ¤– The codemod will replace all `IconButton` children of `SegmentedControl` with
`SegmentedControl.Button`.

---

### Side Panel

The `SidePanel` in our Preview package now has a tooltip built in to its toggle button. If you
currently have a `Tooltip` component wrapping this component, you should remove it. Instead, you'll
need to provide the appropriate tooltip text to the button based on its state using the following
new props added to `SidePanel.ToggleButton`:

```tsx
/**
 * The tooltip text to expand the side panel
 * @default 'Expand'
 */
tooltipTextExpand?: string;
/**
 * The tooltip text to collapse the side panel
 * @default 'Collapse'
 */
tooltipTextCollapse?: string;
```

---

### Status Indicator

Status Indicators currently truncate when they reach their max width of `150px`. After receiving
requests to increase this value, we've increased it by 33% to `200px`.

We've also added a `maxWidth` prop to further configure this value if necessary. While this
increases flexibility, please keep in mind that status text should be short, direct, and preferably
a single word.

```tsx
<StatusIndicator label="Slightly Longer Status" type={StatusIndicator.Type.Gray} maxWidth={250} />
```
