import {Meta} from '@storybook/addon-docs';

<Meta title="Welcome/Migration Guides/v7.0" />

# Canvas Kit 7.0 Migration Guide

Below are the breaking changes made in Canvas Kit v7. Please
[reach out](https://github.com/Workday/canvas-kit/issues/new?labels=bug&template=bug.md) if you have
any questions about the update.

- [Codemod](#codemod)
- [Component Deprecations](#component-deprecations)
- [ActionBar Component Updates](#actionbar-component-updates)
- [Status Indicator Width](#status-indicator-width)
- [Popup Cards](popup-cards)
- [Component Promotions](#component-promotion)
- [Tokens Updates](#tokens-updates)
  - [Depth Tokens](#depth-tokens)

## Codemod

Please use our [codemod package](https://github.com/Workday/canvas-kit/tree/master/modules/codemod)
to automatically update your code to work with a majority of the breaking changes in the migration
from Canvas Kit v6 to v7:

```sh
> npx @workday/canvas-kit-codemod v7 [path]
```

> Note: This codemod only works on `.js`, `.jsx`, `.ts`, and `.tsx` extensions. You may need to make
> some manual changes in other file types (`.json`, `.mdx`, `.md`, etc.).

> Note: You may need to run your linter after executing the codemod, as it's resulting formatting
> (spacing, quotes, etc.) may not match your project's styling.

**Breaking changes accounted for by this codemod will be marked with a ðŸ¤–.**

**Please verify all changes made by the codemod. As a safety precaution, we recommend committing the
changes from the codemod as a single isolated commit (separate from other changes) so you can
rollback more easily if necessary.**

[Let us know](https://github.com/Workday/canvas-kit/issues/new?labels=bug&template=bug.md) if you
encounter any issues or use cases that we've missed. The `@workday/canvas-kit-codemod` package will
help us maintain additional codemod transforms to make future migrations easier.

## Component Deprecations

### Deprecation Types

There are two types of deprecations: soft and hard.

#### Soft Deprecation

A soft-deprecated component is still available with its full functionality, but it will have been
renamed with a prefix to indicate its soft-deprecated status. It will also include a console warning
to announce its deprecation. This warning will only be triggered on the component's initial render.

Soft-deprecated types and utilities will also be renamed but generally will not trigger a console
warning.

#### Hard Deprecation

A hard-deprecated component or package is no longer available. You will need to follow the method
prescribed in our migration guide to update your application. Please reach out to our team directly
if you need additional help.

### Cookie Banner

We are [hard deprecating](#hard-deprecation) `CookieBanner`. If you would like to migrate away from
this deprecated component now, you can reference
[this example](https://workday.github.io/canvas-kit/?path=/story/examples-cookiebanner-react--basic)

### Page Header

We are [hard deprecating](#hard-deprecation) `Page Header`. If you would like to migrate away from
this deprecated component now, you can reference
[this example](https://workday.github.io/canvas-kit/?path=/story/examples-pageheader-react--basic)

### Header / GlobalHeader

We are [hard deprecating](#hard-deprecation) `Header`. If you would like to migrate away from this
deprecated component now, you can reference
[this example](https://workday.github.io/canvas-kit/?path=/story/examples-globalheader-react--basic)

## ActionBar Component Updates

We've refactored our ActionBar components to simplify logic.

PR: https://github.com/Workday/canvas-kit/pull/1396

**Changes:**

- Component has been converted to compound component.
- `fixed` prop has been removed from component.
- Now ActionBar uses `position` prop to set container position instead `fixed` prop.
- Fixed position has been set as default if there is not passed `position` prop.

## Status Indicator Width

Status Indicators currently truncate when they reach their max width of `150px`. After receiving
requests to increase this, we have upped it by 25% to `200px`.

We've also added a prop (`maxWidth`) to configure this if you need to. While this increases
flexibility, please keep in mind that status text should be short, direct, and preferably a single
word.

```tsx
<StatusIndicator label="Slightly Longer Status" type={StatusIndicator.Type.Gray} maxWidth={250} />
```

## Popup Cards

`Popup.Card` (this includes `Modal.Card` and `Dialog.Card`) components are now a flexbox container.
This was done to support overflowing content (by default, the `Popup.Body` component). The idea is
the card is a vertical flexbox container and the `Popup.Heading`, `Popup.Body`, and any other
children are flex items. The `Popup.Body` now has an `overflow-y: auto` on it to naturally allow the
body content to overflow in a scroll container. This is a breaking change if your `Popup`, `Modal`,
or `Dialog` doesn't work with a flexbox with `flex-direction: column`. In most cases, this shouldn't
matter. If this change does cause your popup to display correctly, you may need to play around with
flex item containers.

An example where this might break:

A common Modal has a heading, body, and footer (Cancel/Submit buttons). If the Cancel and Submit
buttons are direct children of the `Modal.Card` like the following:

```tsx
<Modal.Card>
  <Modal.Heading>Some Heading</Modal.Heading>
  <Modal.Body>Some Body</Modal.Body>
  <SecondaryButton>Cancel</SecondaryButton>
  <PrimaryButton>Submit</PrimaryButton>
</Modal.Card>
```

The buttons will become vertical flex items instead of the default which is displaying inline-block.
Before, the buttons would layout next to each other horizontally. After, the buttons will stack
vertically. To fix this, you'll have to add another element to be a flex item from the `Modal.Card`.
Our examples use `HStack` to align the buttons. The following will render correctly after this
change:

```tsx
<Modal.Card>
  <Modal.Heading>Some Heading</Modal.Heading>
  <Modal.Body>Some Body</Modal.Body>
  <HStack spacing="s">
    <SecondaryButton>Cancel</SecondaryButton>
    <PrimaryButton>Submit</PrimaryButton>
  </HStack>
</Modal.Card>
```

If your code contains any hacks to make a `Modal` overflow, these hacks should now be removed.
[This example shows how body content overflows](https://workday.github.io/canvas-kit/?path=/docs/components-popups-modal-react--body-overflow)
(you may have to limit your browser height to see the overflow). Before you had to manually set the
`max-height` of the `Modal.Body` element using calculations. These should be removed. The
`Popup.Card` now has a max height and the `Popup.Body` height is automatically calculated.

## Component Promotions

After some [assessment](https://github.com/Workday/canvas-kit/issues/1395) we've decided to promote
the following components: `Flex`, `Stack`, `Box` and `Breadcumbs`

This promotion does not introduce any API changes, we've just changed moved the components to our
main `react` package.

**Changes:**

- `Box` was promoted from `@workday/canvas-kit-labs/common` to `@workday/canvas-kit-react/layout`
- `Flex` was promoted from `@workday/canvas-kit-labs/layout` to `@workday/canvas-kit-react/layout`
- `Stack` was promoted from `@workday/canvas-kit-labs/layout` to `@workday/canvas-kit-react/layout`

## Token Updates

### Depth Tokens

**Changes:**

- Depth `inset` was removed from token list.
- Added new depth: `none` (to remove default depth from component), `5` and `6`.
- Updated all depth values: now depth adds only `box-shadow` with 2 shadows and no border.

Also we changed default depth for the following components:

- Card: Depth 2 â†’ Depth 1
- Select Menu: Depth 2 â†’ Depth 3
- Breadcrumbs Dropdown Menu: Depth 2 â†’ Depth 3
- Menu: Depth 2 â†’ Depth 3
- Combobox: Depth 1 â†’ Depth 3
- Popup: Depth 2 â†’ Depth 5
- Dialog: Depth 2 â†’ Depth 5
- Color Picker Palette: Depth 2 â†’ Depth 5
- Toast: Depth 2 â†’ Depth 5
- Modal: Depth 2 â†’ Depth 6
- Preview Side Panel (alternate variant): Depth 3 â†’ Depth 6
