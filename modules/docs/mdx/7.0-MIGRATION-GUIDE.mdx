import {Meta} from '@storybook/addon-docs';

<Meta title="Welcome/Migration Guides/v7.0" />

# Canvas Kit 7.0 Migration Guide

Below are the breaking changes made in Canvas Kit v7. Please
[reach out](https://github.com/Workday/canvas-kit/issues/new?labels=bug&template=bug.md) if you have
any questions about the update.

- [Codemod](#codemod)
- [Component Deprecations](#component-deprecations)
- [Buttons](#buttons)
- [Segmented Control](#segmented-control)
- [Icons](#icons)
- [ActionBar Component Updates](#actionbar-component-updates)
- [Status Indicator Width](#status-indicator-width)
- [Popup Cards](popup-cards)
- [Component Promotions](#component-promotion)

## Codemod

Please use our [codemod package](https://github.com/Workday/canvas-kit/tree/master/modules/codemod)
to automatically update your code to work with a majority of the breaking changes in the migration
from Canvas Kit v6 to v7:

```sh
> npx @workday/canvas-kit-codemod v7 [path]
```

> Note: This codemod only works on `.js`, `.jsx`, `.ts`, and `.tsx` extensions. You may need to make
> some manual changes in other file types (`.json`, `.mdx`, `.md`, etc.).

> Note: You may need to run your linter after executing the codemod, as it's resulting formatting
> (spacing, quotes, etc.) may not match your project's styling.

**Breaking changes accounted for by this codemod will be marked with a ðŸ¤–.**

**Please verify all changes made by the codemod. As a safety precaution, we recommend committing the
changes from the codemod as a single isolated commit (separate from other changes) so you can
rollback more easily if necessary.**

[Let us know](https://github.com/Workday/canvas-kit/issues/new?labels=bug&template=bug.md) if you
encounter any issues or use cases that we've missed. The `@workday/canvas-kit-codemod` package will
help us maintain additional codemod transforms to make future migrations easier.

## Component Deprecations

### Deprecation Types

There are two types of deprecations: soft and hard.

#### Soft Deprecation

A soft-deprecated component is still available with its full functionality, but it will have been
renamed with a prefix to indicate its soft-deprecated status. It will also include a console warning
to announce its deprecation. This warning will only be triggered on the component's initial render.

Soft-deprecated types and utilities will also be renamed but generally will not trigger a console
warning.

#### Hard Deprecation

A hard-deprecated component or package is no longer available. You will need to follow the method
prescribed in our migration guide to update your application. Please reach out to our team directly
if you need additional help.

### Cookie Banner

We are [hard deprecating](#hard-deprecation) `CookieBanner`. If you would like to migrate away from
this deprecated component now, you can reference
[this example](https://workday.github.io/canvas-kit/?path=/story/examples-cookiebanner-react--basic)

### Page Header

We are [hard deprecating](#hard-deprecation) `Page Header`. If you would like to migrate away from
this deprecated component now, you can reference
[this example](https://workday.github.io/canvas-kit/?path=/story/examples-pageheader-react--basic)

### Header / GlobalHeader

We are [hard deprecating](#hard-deprecation) `Header`. If you would like to migrate away from this
deprecated component now, you can reference
[this example](https://workday.github.io/canvas-kit/?path=/story/examples-globalheader-react--basic)

## ActionBar Component Updates

We've refactored our ActionBar components to simplify logic.

PR: https://github.com/Workday/canvas-kit/pull/1396

**Changes:**

- Component has been converted to compound component.
- `fixed` prop has been removed from component.
- Now ActionBar uses `position` prop to set container position instead `fixed` prop.
- Fixed position has been set as default if there is not passed `position` prop.

## Status Indicator Width

Status Indicators currently truncate when they reach their max width of `150px`. After receiving
requests to increase this, we have upped it by 25% to `200px`.

We've also added a prop (`maxWidth`) to configure this if you need to. While this increases
flexibility, please keep in mind that status text should be short, direct, and preferably a single
word.

```tsx
<StatusIndicator label="Slightly Longer Status" type={StatusIndicator.Type.Gray} maxWidth={250} />
```

## Buttons

As part of our efforts to decrease variants and consolidate APIs, we've combined `IconButton` with
our `PrimaryButton`, `SecondaryButton` and `TertiaryButton`.

**Breaking Changes:**

- Removed the `toggled` prop when migrating over Icon Buttons
- Changed the values of `IconPosition: left | right` - > `IconPosition: start | end`
- Remove `dataLabel` prop from `PrimaryButton` and `SecondaryButton`

### Button Mapping

Below is a mapping of `IconButtons` to their respective buttons. _Note_: We're no longer supporting
what use to be `plain`, `square` and `squareFilled` as well as the `toggled` prop.

| IconButton variant | Button Type                          |
| ------------------ | ------------------------------------ |
| `circle`           | TertiaryButton                       |
| `circleFilled`     | SecondaryButton                      |
| `inverse`          | TertiButton with variant inverse     |
| `inverseFilled`    | SecondaryButton with variant inverse |
| `plain`            | Not Supporting                       |
| `square`           | Not Supporting                       |
| `squareFilled`     | Not Supporting                       |

### Removal of variants Square, SquareFilled, and Plain as well as the Toggled Prop

As part of simplyging our variants and cleaning up the API, we've removed the variants `square`,
`squareFilled` and `plain`. We've also removed the prop `toggled`.

If you would still like to have a squared icon, you can use
[ToolbarIconButton](https://workday.github.io/canvas-kit/?path=/docs/components-buttons-button-react-toolbar--toolbar-icon-button)
which also has the `toggled`prop.

If this button doesn't fit your specific use case, we've introduced a low level
[`BaseButton` component](#basebutton-component). This component allows you to modify the colors,
props, and size of the button. For an example of this being used, you can reference our
[PageButton component](https://github.com/Workday/canvas-kit/blob/master/modules/react/pagination/lib/Pagination/PageButton.tsx).

### Rendering an icon button

In order to render a icon button, omit any `children` and pass the button an `icon` prop.

Example

v6

```tsx
<IconButton variant="circleFilled" icon={plusIcon} />
```

v7

```tsx
<SecondaryButton icon={plusIcon} />
```

You can now render what use to be an `IconButton` using our main buttons.

```tsx
<PrimaryButton icon={plusIcon} />
<SecondaryButton icon={plusIcon} />
<TertiaryButton icon={plusIcon} />
<PrimaryButton variant='inverse' icon={plusIcon} />
<SecondaryButton variant='inverse' icon={plusIcon} />
<TertiaryButton variant='inverse' icon={plusIcon} />
```

### Button sizes

Each button now supports sizes: `extraSmall`, `small`, `medium` and `large` with `medium` being the
default size.

```tsx
  <PrimaryButton icon={plusIcon} size='extraSmall' />
  <PrimaryButton icon={plusIcon} size='small' />
  <PrimaryButton icon={plusIcon} size='medium' /> // default
  <PrimaryButton icon={plusIcon} size='large' />
```

### Button Icon position

The prop `iconPosition` which is used to determine which side an icon should be when rendered with
some text, has been changed. The default is `start`

v6

```tsx
iconPosition: 'left' | 'right';
```

v7

```tsx
iconPosition: 'start' | 'end';
```

_Note:_ The position of the icon should have no affect if you're rending an icon button.

### Removal of `dataLabel` Prop

The `dataLabel` prop has been removed from our Buttons in v7 in order to simplify the API.

_Note:_ The codemod will not remove this prop since use of this prop varies. If you'd like to still
have a similar effect, below is an example of how to achieve this.

v6

```tsx
<PrimaryButton dataLabel="1:00">Time</PrimaryButton>
```

v7

```tsx
<PrimaryButton>
  Time
  <span
    style={{
      position: 'relative', // Fixes an IE issue with text within button moving on click
      textOverflow: 'ellipsis',
      overflow: 'hidden',
      whiteSpace: 'nowrap',
      fontWeight: 400,
      marginLeft: 4,
    }}
  >
    1:00
  </span>
</PrimaryButton>
```

### BaseButton Component

As part of the restructure of our Buttons, we've created a low level `BaseButton` component. This
component isn't intended to be used outside of Canvas Kit, but we do export it for very specific use
cases which we'll outline below. The `BaseButton` is a styled `button` element which extends our
style properties which allow us to customize a buttons `colors`, `padding`, `width` and other style
properties.

Basic example:

```tsx
import * as React from 'react';
import {colors} from '@workday/canvas-kit-react/tokens';
import {BaseButton} from '@workday/canvas-kit-react/button';
import {plusIcon} from '@workday/canvas-system-icons-web';

const getBasicButtonColors = () => {
  return {
    default: {
      background: colors.blueberry400,
      label: colors.frenchVanilla100,
      icon: colors.frenchVanilla100,
    },
    hover: {
      background: colors.blueberry500,
      label: colors.frenchVanilla100,
      icon: colors.frenchVanilla100,
    },
    active: {
      background: colors.blueberry500,
      label: colors.frenchVanilla100,
      icon: colors.frenchVanilla100,
    },
    focus: {
      background: colors.blueberry400,
      label: colors.frenchVanilla100,
      icon: colors.frenchVanilla100,
    },
    disabled: {
      background: colors.blueberry400,
    },
  };
};

export type BasicButtonProps = React.ButtonHTMLAttributes<HTMLButtonElement> & {};

export const BasicButton = ({children, ...elemProps}: BasicButtonProps) => {
  return (
    <BaseButton
      colors={getPaginationButtonColors(toggled)}
      {...elemProps}
    >
      <BaseButton.Label>{children}</BaseButton.Label>
      <BaseButton.Icon icon={plusIcon}>
    </StyledToggleButton>
  );
};
```

**Note:** Under the hood, `BaseButton` uses our `Box` component which allows `BaseButton` to accept
style properties. Because of the flexibility of this component, consumers can use this to create
toggled buttons or a specific button that doesn't fall under the main use case you see in our design
system.

**Disclaimer** We strongly advise consumers not to use this component if possible and to rely on our
`PrimaryButton`, `SecondaryButton` and `TertiaryButton` when possible.

## Segmented Control

Segmente Control use to work when rendering `IconButton` as children. This has now moved to a
compound component and removed the use of `IconButton`.

v6

```tsx
<SegmentedControl value={value} onChange={handleToggle}>
  <IconButton
    icon={listViewIcon}
    value="list-view"
    aria-label="List View"
    onClick={e => console.log('Existing IconButton onClick callback')}
  />
  <IconButton icon={worksheetsIcon} value="table-view" aria-label="Table View" disabled={true} />
  <IconButton icon={deviceTabletIcon} value="device-view" aria-label="Device View" />
  <IconButton icon={percentageIcon} value="percent-view" aria-label="Percent View" />
</SegmentedControl>
```

v7

```tsx
<SegmentedControl value={value} onChange={handleToggle}>
  <SegmentedControl.Button
    icon={listViewIcon}
    value="list-view"
    aria-label="List View"
    onClick={e => console.log('Existing IconButton onClick callback')}
  />
  <SegmentedControl.Button
    icon={worksheetsIcon}
    value="table-view"
    aria-label="Table View"
    disabled={true}
  />
  <SegmentedControl.Button icon={deviceTabletIcon} value="device-view" aria-label="Device View" />
  <SegmentedControl.Button icon={percentageIcon} value="percent-view" aria-label="Percent View" />
</SegmentedControl>
```

## Icons

We've updated our lower level icon components such as `AccentIcon`, `AppletIcon`, `Graphic`, `Icon`,
`Svg`, `SystemIcon`, and `SystemIconCircle` to use our
[createComponent](https://github.com/Workday/canvas-kit/blob/ff77c5bd83e41c3ab2b9c55e41a8b7c1fde33a1b/modules/react/common/lib/utils/components.ts#L167)
which allows us to `forwardRef`.

_Note:_ This is a breaking change since we've removed `iconRef`. You can now just pass a `ref` to
the element.

## Popup Cards

`Popup.Card` (this includes `Modal.Card` and `Dialog.Card`) components are now a flexbox container.
This was done to support overflowing content (by default, the `Popup.Body` component). The idea is
the card is a vertical flexbox container and the `Popup.Heading`, `Popup.Body`, and any other
children are flex items. The `Popup.Body` now has an `overflow-y: auto` on it to naturally allow the
body content to overflow in a scroll container. This is a breaking change if your `Popup`, `Modal`,
or `Dialog` doesn't work with a flexbox with `flex-direction: column`. In most cases, this shouldn't
matter. If this change does cause your popup to display correctly, you may need to play around with
flex item containers.

An example where this might break:

A common Modal has a heading, body, and footer (Cancel/Submit buttons). If the Cancel and Submit
buttons are direct children of the `Modal.Card` like the following:

```tsx
<Modal.Card>
  <Modal.Heading>Some Heading</Modal.Heading>
  <Modal.Body>Some Body</Modal.Body>
  <SecondaryButton>Cancel</SecondaryButton>
  <PrimaryButton>Submit</PrimaryButton>
</Modal.Card>
```

The buttons will become vertical flex items instead of the default which is displaying inline-block.
Before, the buttons would layout next to each other horizontally. After, the buttons will stack
vertically. To fix this, you'll have to add another element to be a flex item from the `Modal.Card`.
Our examples use `HStack` to align the buttons. The following will render correctly after this
change:

```tsx
<Modal.Card>
  <Modal.Heading>Some Heading</Modal.Heading>
  <Modal.Body>Some Body</Modal.Body>
  <HStack spacing="s">
    <SecondaryButton>Cancel</SecondaryButton>
    <PrimaryButton>Submit</PrimaryButton>
  </HStack>
</Modal.Card>
```

If your code contains any hacks to make a `Modal` overflow, these hacks should now be removed.
[This example shows how body content overflows](https://workday.github.io/canvas-kit/?path=/docs/components-popups-modal-react--body-overflow)
(you may have to limit your browser height to see the overflow). Before you had to manually set the
`max-height` of the `Modal.Body` element using calculations. These should be removed. The
`Popup.Card` now has a max height and the `Popup.Body` height is automatically calculated.

## Component Promotions

After some [assessment](https://github.com/Workday/canvas-kit/issues/1395) we've decided to promote
the following components: `Flex`, `Stack`, `Box` and `Breadcumbs`

This promotion does not introduce any API changes, we've just changed moved the components to our
main `react` package.

**Changes:**

- `Box` was promoted from `@workday/canvas-kit-labs/common` to `@workday/canvas-kit-react/layout`
- `Flex` was promoted from `@workday/canvas-kit-labs/layout` to `@workday/canvas-kit-react/layout`
- `Stack` was promoted from `@workday/canvas-kit-labs/layout` to `@workday/canvas-kit-react/layout`
