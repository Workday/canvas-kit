import {Meta} from '@storybook/blocks';
import {ExampleCodeBlock} from '@workday/canvas-kit-docs';
import {PaletteGenerator} from './examples/PaletteGenerator';

<Meta title="Features/Palette Generator (Experimental)" />

# Accessible Palette Generator (Experimental)

Generate WCAG-compliant color palettes from any input color. The palette generator creates a 13-step color scale optimized for accessibility, ensuring that key steps meet contrast requirements.

## Overview

The `generateAccessiblePalette` function takes any valid CSS color and generates a complete palette with:

- **13 color steps**: 25, 50, 100, 200, 300, 400, 500, 600, 700, 800, 900, 950, 975
- **Alpha (transparency)**: Each step has transparent variants (a25, a50, a100, a200) that composite over the palette background
- **WCAG contrast guarantees**: Steps 500 and 600 are optimized to meet AA contrast requirements
- **Gamut mapping**: Colors stay within sRGB or P3 color gamuts
- **Multiple input formats**: Supports hex, rgb, hsl, oklch, and more

## Interactive Example

Try entering different colors to see how the palette generator creates accessible color scales:

<ExampleCodeBlock code={PaletteGenerator} />

## Installation

The palette generator is in `@workday/canvas-kit-labs-react/common`:

```tsx
import {generateAccessiblePalette} from '@workday/canvas-kit-labs-react/common';
```

## Basic Usage

```tsx
import {generateAccessiblePalette} from '@workday/canvas-kit-labs-react/common';

// Generate a palette from a hex color
const palette = generateAccessiblePalette('#0875E1');

// Access specific steps
const primary = palette.getHex(500); // Main brand color
const light = palette.getHex(100); // Light variant
const dark = palette.getHex(800); // Dark variant

// Get full step data with accessibility info
const step = palette.getStep(500);
console.log(step.hex); // "#0875E1"
console.log(step.contrastRatio); // 4.52
console.log(step.wcagAA); // true
console.log(step.wcagAAA); // false
```

## Input Formats

The palette generator accepts any valid CSS color format:

```tsx
// Hex colors
generateAccessiblePalette('#0875E1');
generateAccessiblePalette('#08e');

// RGB colors
generateAccessiblePalette('rgb(8, 117, 225)');
generateAccessiblePalette('rgba(8, 117, 225, 1)');

// HSL colors
generateAccessiblePalette('hsl(210, 93%, 46%)');

// OKLCH colors (recommended for perceptual uniformity)
generateAccessiblePalette('oklch(0.55 0.2 250)');
```

## Configuration Options

```tsx
interface GeneratePaletteOptions {
  // Color gamut: 'sRGB' (default) or 'P3'
  gamut?: 'sRGB' | 'P3';

  // Palette type: 'accessible' (default) or 'neutral'
  paletteType?: 'accessible' | 'neutral';

  // Background luminance (0-1). Values < 0.18 = dark mode
  // Default: 1.0 (white background)
  backgroundLuminance?: number;

  // Minimum chroma for the palette
  // Default: 0.02
  minChroma?: number;

  // Amount of hue shift (0-10)
  // Default: 5
  hueShiftAmount?: number;
}
```

### Dark Mode Palettes

For dark mode interfaces, set `backgroundLuminance` to a low value:

```tsx
const darkModePalette = generateAccessiblePalette('#0875E1', {
  backgroundLuminance: 0.1, // Dark background
});

// The palette will be inverted, with lighter colors at higher step numbers
```

### Neutral Palettes

Generate low-chroma palettes for backgrounds and surfaces:

```tsx
import {generateNeutralPalette} from '@workday/canvas-kit-labs-react/common';

// Generate neutral grays with a blue tint
const neutrals = generateNeutralPalette(220);

// Or extract hue from an existing color
const neutrals = generateNeutralPalette('#0875E1');
```

### P3 Wide Gamut

For displays that support Display P3, you can generate more vibrant colors:

```tsx
const p3Palette = generateAccessiblePalette('#0875E1', {
  gamut: 'P3',
});
```

## Palette Step Structure

Each step in the palette contains detailed information:

```tsx
interface PaletteStep {
  step: number; // 25, 50, 100, 200, etc.
  hex: string; // Hex color value
  oklch: {
    // OKLCH color values
    l: number; // Lightness (0-1)
    c: number; // Chroma (0-0.4+)
    h: number; // Hue (0-360)
  };
  contrastRatio: number; // Against background
  wcagAA: boolean; // Meets 4.5:1
  wcagAAA: boolean; // Meets 7:1
  alpha?: Record<AlphaLevel, string>; // Hex with alpha (#RRGGBBAA) for a25, a50, a100, a200
}
```

## Mapping to Canvas Tokens

The primary use case for this tool is to generate values for `@workday/canvas-tokens-web` brand tokens. The accessible palette includes solid steps and **alpha (transparency)** variants for each step with true alpha channel: a25 (8% opacity), a50 (11%), a100 (17%), a200 (31%). Alpha tokens use the same step color with an alpha channel (e.g. `oklch(L C H / 0.11)` for a50).

**Solid steps:**

| Palette Step | Brand Token | CSS Variable |
|-------------|-------------|--------------|
| 25 | `brand.primary.lightest` | `--cnvs-brand-primary-lightest` |
| 50 | `brand.primary.lighter` | `--cnvs-brand-primary-lighter` |
| 200 | `brand.primary.light` | `--cnvs-brand-primary-light` |
| 600 | `brand.primary.base` | `--cnvs-brand-primary-base` |
| 700 | `brand.primary.dark` | `--cnvs-brand-primary-dark` |
| 800 | `brand.primary.darkest` | `--cnvs-brand-primary-darkest` |

**Alpha (transparency) levels (per step) â€” alpha channel values:**

| Alpha level | Alpha channel | Example CSS variable |
|-------------|---------------|----------------------|
| `a25` | 8% opacity (0.08) | `--cnvs-brand-primary-a25` |
| `a50` | 11% opacity (0.11) | `--cnvs-brand-primary-a50` |
| `a100` | 17% opacity (0.17) | `--cnvs-brand-primary-a100` |
| `a200` | 31% opacity (0.31) | `--cnvs-brand-primary-a200` |

Use the palette API for both solid and alpha (alpha channel = true transparency):

```tsx
const palette = generateAccessiblePalette('#0875E1');

// Solid steps
palette.getHex(600); // "#0875e1"

// Alpha channel: same step color with opacity (a25=8%, a50=11%, a100=17%, a200=31%)
palette.getAlphaHex(600, 'a25');   // #RRGGBB + alpha 0.08
palette.getAlphaHex(600, 'a50');   // #RRGGBB + alpha 0.11
palette.getAlphaHex(600, 'a100');  // #RRGGBB + alpha 0.17
palette.getAlphaHex(600, 'a200');  // #RRGGBB + alpha 0.31
palette.getAlphaRgba(600, 'a50');  // e.g. "rgba(8, 117, 225, 0.11)"
palette.getAlphaOklch(600, 'a50'); // e.g. "oklch(0.6152 0.2108 256.1 / 0.11)"
```

For custom alpha over a custom background, use `alphaColor` from the same package (see alpha compositing utilities).

### Configuring Brand Tokens via CSS

The recommended approach is to set brand tokens in your root CSS file:

```css
/* index.css */
@import '@workday/canvas-tokens-web/css/base/_variables.css';
@import '@workday/canvas-tokens-web/css/system/_variables.css';
@import '@workday/canvas-tokens-web/css/brand/_variables.css';

:root {
  /* Generated from palette generator with brand color #E91E63 */
  --cnvs-brand-primary-lightest: #fef1f4;
  --cnvs-brand-primary-lighter: #fde3ea;
  --cnvs-brand-primary-light: #f9a8be;
  --cnvs-brand-primary-base: #d81b5c;
  --cnvs-brand-primary-dark: #b8164d;
  --cnvs-brand-primary-darkest: #99123f;
}
```

### Configuring Brand Tokens via JavaScript

You can also use the palette generator with `createStyles` for runtime theming:

```tsx
import {generateAccessiblePalette} from '@workday/canvas-kit-labs-react/common';
import {createStyles} from '@workday/canvas-kit-styling';
import {brand} from '@workday/canvas-tokens-web';

// Generate a palette from your brand color
const palette = generateAccessiblePalette('#E91E63');

// Create a theme using the generated colors (solid + alpha)
const customBrandTheme = createStyles({
  [brand.primary.lightest]: palette.getHex(25),
  [brand.primary.lighter]: palette.getHex(50),
  [brand.primary.light]: palette.getHex(200),
  [brand.primary.base]: palette.getHex(600),
  [brand.primary.dark]: palette.getHex(700),
  [brand.primary.darkest]: palette.getHex(800),
  // Alpha variants (use your token names for brand.primary.a25, etc.)
  // palette.getAlphaHex(600, 'a25'), palette.getAlphaHex(600, 'a50'), ...
});
```

> **Note:** The interactive example above includes a "Canvas Tokens Mapping" section with copy buttons for each token, making it easy to grab the exact CSS you need.

## Advanced Usage

For advanced use cases, additional utilities are exported:

```tsx
import {
  // Main functions
  generateAccessiblePalette,
  generateNeutralPalette,
  paletteSteps, // [25, 50, 100, 200, 300, 400, 500, 600, 700, 800, 900, 950, 975]

  // Color conversion utilities
  parseColorToOklch,
  hexToOklch,
  oklchToHex,
  hexToRgb,

  // Accessibility utilities
  meetsWCAGContrast,
  checkContrastRatio,

  // Gamut utilities
  computeMaxChroma,
  isInGamut,

  // Alpha compositing (custom alpha over custom background)
  alphaColor,
  formatRGBA,
  rgbToHex,

  // colorjs.io Color class for advanced manipulation
  Color,
} from '@workday/canvas-kit-labs-react/common';

// Example: Check if a color meets contrast requirements
const color = parseColorToOklch('#0875E1');
const contrast = checkContrastRatio(color, 1.0); // Against white background
console.log(meetsWCAGContrast(contrast, 'AA')); // true
```

## How It Works

The palette generator uses the OKLCH color space for perceptually uniform color manipulation:

1. **Parse Input**: Converts any CSS color to OKLCH using colorjs.io
2. **Extract Hue**: Uses the input color's hue as the base for the palette
3. **Compute Lightness**: Maps each step to a lightness value (light to dark)
4. **Compute Chroma**: Applies a curve that peaks around step 500-600
5. **Gamut Mapping**: Ensures colors stay within the target gamut (sRGB/P3)
6. **Contrast Adjustment**: Fine-tunes steps 500 and 600 for WCAG compliance

The result is a palette that maintains the hue of your input color while providing a full range of accessible shades.
